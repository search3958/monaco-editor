{"version":3,"sources":["file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src/vs/platform/markdown/browser/markdownRenderer.ts","vs/platform/markdown/browser/markdownRenderer.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAA4C,cAAc,EAAE,MAAM,2CAA2C,CAAC;AACrH,OAAO,EAAE,iBAAiB,EAAE,MAAM,gCAAgC,CAAC;AAEnE,OAAO,EAAqB,iBAAiB,EAAE,MAAM,0CAA0C,CAAC;AAChG,OAAO,EAAE,eAAe,EAAE,MAAM,6CAA6C,CAAC;AAC9E,OAAO,EAAE,cAAc,EAAE,MAAM,+BAA+B,CAAC;AAwB/D,MAAM,CAAC,MAAM,wBAAwB,GAAG,eAAe,CAA2B,yBAAyB,CAAC,CAAC;AAmBtG,IAAM,uBAAuB,GAA7B,MAAM,uBAAuB;IAKnC,YACkC,cAA8B;QAA9B,mBAAc,GAAd,cAAc,CAAgB;IAC5D,CAAC;IAEL,MAAM,CAAC,QAAyB,EAAE,OAA+D,EAAE,UAAwB;QAC1H,MAAM,eAAe,GAAG,EAAE,GAAG,OAAO,EAAE,CAAC;QAEvC,IAAI,CAAC,eAAe,CAAC,aAAa,EAAE,CAAC;YACpC,eAAe,CAAC,aAAa,GAAG,CAAC,IAAI,EAAE,KAAK,EAAE,EAAE;gBAC/C,OAAO,oBAAoB,CAAC,IAAI,CAAC,cAAc,EAAE,IAAI,EAAE,KAAK,CAAC,SAAS,CAAC,CAAC;YACzE,CAAC,CAAC;QACH,CAAC;QAED,IAAI,CAAC,eAAe,CAAC,iBAAiB,EAAE,CAAC;YACxC,eAAe,CAAC,iBAAiB,GAAG,CAAC,KAAK,EAAE,KAAK,EAAE,EAAE;gBACpD,OAAO,IAAI,CAAC,yBAAyB,EAAE,eAAe,CAAC,KAAK,EAAE,KAAK,EAAE,eAAe,IAAI,EAAE,CAAC,IAAI,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,CAAC;YAChJ,CAAC,CAAC;QACH,CAAC;QAED,MAAM,QAAQ,GAAG,cAAc,CAAC,QAAQ,EAAE,eAAe,EAAE,UAAU,CAAC,CAAC;QACvE,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC;QACpD,OAAO,QAAQ,CAAC;IACjB,CAAC;IAED,2BAA2B,CAAC,QAAoC;QAC/D,IAAI,CAAC,yBAAyB,GAAG,QAAQ,CAAC;IAC3C,CAAC;CACD,CAAA;AAhCY,uBAAuB;IAMjC,WAAA,cAAc,CAAA;GANJ,uBAAuB,CAgCnC;;AAED,MAAM,CAAC,KAAK,UAAU,oBAAoB,CAAC,aAA6B,EAAE,IAAY,EAAE,SAA6D,EAAE,cAAwB;IAC9K,IAAI,CAAC;QACJ,OAAO,MAAM,aAAa,CAAC,IAAI,CAAC,IAAI,EAAE;YACrC,eAAe,EAAE,IAAI;YACrB,uBAAuB,EAAE,IAAI;YAC7B,aAAa,EAAE,qBAAqB,CAAC,SAAS,CAAC;YAC/C,cAAc;SACd,CAAC,CAAC;IACJ,CAAC;IAAC,OAAO,CAAC,EAAE,CAAC;QACZ,iBAAiB,CAAC,CAAC,CAAC,CAAC;QACrB,OAAO,KAAK,CAAC;IACd,CAAC;AACF,CAAC;AAED,SAAS,qBAAqB,CAAC,SAA6D;IAC3F,IAAI,SAAS,KAAK,IAAI,EAAE,CAAC;QACxB,OAAO,IAAI,CAAC,CAAC,qBAAqB;IACnC,CAAC;IAED,IAAI,SAAS,IAAI,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,eAAe,CAAC,EAAE,CAAC;QAC3D,OAAO,SAAS,CAAC,eAAe,CAAC,CAAC,2BAA2B;IAC9D,CAAC;IAED,OAAO,KAAK,CAAC,CAAC,iBAAiB;AAChC,CAAC;AAED,iBAAiB,CAAC,wBAAwB,EAAE,uBAAuB,oCAA4B,CAAC","file":"markdownRenderer.js","sourceRoot":"file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IRenderedMarkdown, MarkdownRenderOptions, renderMarkdown } from '../../../base/browser/markdownRenderer.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { IMarkdownString, MarkdownStringTrustedOptions } from '../../../base/common/htmlContent.js';\nimport { InstantiationType, registerSingleton } from '../../instantiation/common/extensions.js';\nimport { createDecorator } from '../../instantiation/common/instantiation.js';\nimport { IOpenerService } from '../../opener/common/opener.js';\n\n/**\n * Renders markdown to HTML.\n *\n * This interface allows a upper level component to pass a custom markdown renderer to sub-components.\n *\n * If you want to render markdown content in a standard way, prefer using the {@linkcode IMarkdownRendererService}.\n */\nexport interface IMarkdownRenderer {\n}\n\nexport interface IMarkdownRendererExtraOptions {\n\t/**\n\t * The context in which the markdown is being rendered.\n\t */\n\treadonly context?: unknown;\n}\n\nexport interface IMarkdownCodeBlockRenderer {\n\trenderCodeBlock(languageAlias: string | undefined, value: string, options: IMarkdownRendererExtraOptions): Promise<HTMLElement>;\n}\n\n\nexport const IMarkdownRendererService = createDecorator<IMarkdownRendererService>('markdownRendererService');\n\n/**\n * Service that renders markdown content in a standard manner.\n *\n * Unlike the lower-level {@linkcode renderMarkdown} function, this includes built-in support for features such as syntax\n * highlighting of code blocks and link handling.\n *\n * This service should be preferred for rendering markdown in most cases.\n */\nexport interface IMarkdownRendererService extends IMarkdownRenderer {\n\treadonly _serviceBrand: undefined;\n\n\trender(markdown: IMarkdownString, options?: MarkdownRenderOptions & IMarkdownRendererExtraOptions, outElement?: HTMLElement): IRenderedMarkdown;\n\n\tsetDefaultCodeBlockRenderer(renderer: IMarkdownCodeBlockRenderer): void;\n}\n\n\nexport class MarkdownRendererService implements IMarkdownRendererService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate _defaultCodeBlockRenderer: IMarkdownCodeBlockRenderer | undefined;\n\n\tconstructor(\n\t\t@IOpenerService private readonly _openerService: IOpenerService,\n\t) { }\n\n\trender(markdown: IMarkdownString, options?: MarkdownRenderOptions & IMarkdownRendererExtraOptions, outElement?: HTMLElement): IRenderedMarkdown {\n\t\tconst resolvedOptions = { ...options };\n\n\t\tif (!resolvedOptions.actionHandler) {\n\t\t\tresolvedOptions.actionHandler = (link, mdStr) => {\n\t\t\t\treturn openLinkFromMarkdown(this._openerService, link, mdStr.isTrusted);\n\t\t\t};\n\t\t}\n\n\t\tif (!resolvedOptions.codeBlockRenderer) {\n\t\t\tresolvedOptions.codeBlockRenderer = (alias, value) => {\n\t\t\t\treturn this._defaultCodeBlockRenderer?.renderCodeBlock(alias, value, resolvedOptions ?? {}) ?? Promise.resolve(document.createElement('span'));\n\t\t\t};\n\t\t}\n\n\t\tconst rendered = renderMarkdown(markdown, resolvedOptions, outElement);\n\t\trendered.element.classList.add('rendered-markdown');\n\t\treturn rendered;\n\t}\n\n\tsetDefaultCodeBlockRenderer(renderer: IMarkdownCodeBlockRenderer): void {\n\t\tthis._defaultCodeBlockRenderer = renderer;\n\t}\n}\n\nexport async function openLinkFromMarkdown(openerService: IOpenerService, link: string, isTrusted: boolean | MarkdownStringTrustedOptions | undefined, skipValidation?: boolean): Promise<boolean> {\n\ttry {\n\t\treturn await openerService.open(link, {\n\t\t\tfromUserGesture: true,\n\t\t\tallowContributedOpeners: true,\n\t\t\tallowCommands: toAllowCommandsOption(isTrusted),\n\t\t\tskipValidation\n\t\t});\n\t} catch (e) {\n\t\tonUnexpectedError(e);\n\t\treturn false;\n\t}\n}\n\nfunction toAllowCommandsOption(isTrusted: boolean | MarkdownStringTrustedOptions | undefined): boolean | readonly string[] {\n\tif (isTrusted === true) {\n\t\treturn true; // Allow all commands\n\t}\n\n\tif (isTrusted && Array.isArray(isTrusted.enabledCommands)) {\n\t\treturn isTrusted.enabledCommands; // Allow subset of commands\n\t}\n\n\treturn false; // Block commands\n}\n\nregisterSingleton(IMarkdownRendererService, MarkdownRendererService, InstantiationType.Delayed);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IRenderedMarkdown, MarkdownRenderOptions, renderMarkdown } from '../../../base/browser/markdownRenderer.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { IMarkdownString, MarkdownStringTrustedOptions } from '../../../base/common/htmlContent.js';\nimport { InstantiationType, registerSingleton } from '../../instantiation/common/extensions.js';\nimport { createDecorator } from '../../instantiation/common/instantiation.js';\nimport { IOpenerService } from '../../opener/common/opener.js';\n\n/**\n * Renders markdown to HTML.\n *\n * This interface allows a upper level component to pass a custom markdown renderer to sub-components.\n *\n * If you want to render markdown content in a standard way, prefer using the {@linkcode IMarkdownRendererService}.\n */\nexport interface IMarkdownRenderer {\n}\n\nexport interface IMarkdownRendererExtraOptions {\n\t/**\n\t * The context in which the markdown is being rendered.\n\t */\n\treadonly context?: unknown;\n}\n\nexport interface IMarkdownCodeBlockRenderer {\n\trenderCodeBlock(languageAlias: string | undefined, value: string, options: IMarkdownRendererExtraOptions): Promise<HTMLElement>;\n}\n\n\nexport const IMarkdownRendererService = createDecorator<IMarkdownRendererService>('markdownRendererService');\n\n/**\n * Service that renders markdown content in a standard manner.\n *\n * Unlike the lower-level {@linkcode renderMarkdown} function, this includes built-in support for features such as syntax\n * highlighting of code blocks and link handling.\n *\n * This service should be preferred for rendering markdown in most cases.\n */\nexport interface IMarkdownRendererService extends IMarkdownRenderer {\n\treadonly _serviceBrand: undefined;\n\n\trender(markdown: IMarkdownString, options?: MarkdownRenderOptions & IMarkdownRendererExtraOptions, outElement?: HTMLElement): IRenderedMarkdown;\n\n\tsetDefaultCodeBlockRenderer(renderer: IMarkdownCodeBlockRenderer): void;\n}\n\n\nexport class MarkdownRendererService implements IMarkdownRendererService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate _defaultCodeBlockRenderer: IMarkdownCodeBlockRenderer | undefined;\n\n\tconstructor(\n\t\t@IOpenerService private readonly _openerService: IOpenerService,\n\t) { }\n\n\trender(markdown: IMarkdownString, options?: MarkdownRenderOptions & IMarkdownRendererExtraOptions, outElement?: HTMLElement): IRenderedMarkdown {\n\t\tconst resolvedOptions = { ...options };\n\n\t\tif (!resolvedOptions.actionHandler) {\n\t\t\tresolvedOptions.actionHandler = (link, mdStr) => {\n\t\t\t\treturn openLinkFromMarkdown(this._openerService, link, mdStr.isTrusted);\n\t\t\t};\n\t\t}\n\n\t\tif (!resolvedOptions.codeBlockRenderer) {\n\t\t\tresolvedOptions.codeBlockRenderer = (alias, value) => {\n\t\t\t\treturn this._defaultCodeBlockRenderer?.renderCodeBlock(alias, value, resolvedOptions ?? {}) ?? Promise.resolve(document.createElement('span'));\n\t\t\t};\n\t\t}\n\n\t\tconst rendered = renderMarkdown(markdown, resolvedOptions, outElement);\n\t\trendered.element.classList.add('rendered-markdown');\n\t\treturn rendered;\n\t}\n\n\tsetDefaultCodeBlockRenderer(renderer: IMarkdownCodeBlockRenderer): void {\n\t\tthis._defaultCodeBlockRenderer = renderer;\n\t}\n}\n\nexport async function openLinkFromMarkdown(openerService: IOpenerService, link: string, isTrusted: boolean | MarkdownStringTrustedOptions | undefined, skipValidation?: boolean): Promise<boolean> {\n\ttry {\n\t\treturn await openerService.open(link, {\n\t\t\tfromUserGesture: true,\n\t\t\tallowContributedOpeners: true,\n\t\t\tallowCommands: toAllowCommandsOption(isTrusted),\n\t\t\tskipValidation\n\t\t});\n\t} catch (e) {\n\t\tonUnexpectedError(e);\n\t\treturn false;\n\t}\n}\n\nfunction toAllowCommandsOption(isTrusted: boolean | MarkdownStringTrustedOptions | undefined): boolean | readonly string[] {\n\tif (isTrusted === true) {\n\t\treturn true; // Allow all commands\n\t}\n\n\tif (isTrusted && Array.isArray(isTrusted.enabledCommands)) {\n\t\treturn isTrusted.enabledCommands; // Allow subset of commands\n\t}\n\n\treturn false; // Block commands\n}\n\nregisterSingleton(IMarkdownRendererService, MarkdownRendererService, InstantiationType.Delayed);\n"]}