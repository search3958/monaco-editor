{"version":3,"sources":["file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src/vs/platform/quickinput/browser/tree/quickInputTreeController.ts","vs/platform/quickinput/browser/tree/quickInputTreeController.ts"],"names":[],"mappings":"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","file":"quickInputTreeController.js","sourceRoot":"file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../base/browser/dom.js';\nimport { RenderIndentGuides } from '../../../../base/browser/ui/tree/abstractTree.js';\nimport { IHoverDelegate } from '../../../../base/browser/ui/hover/hoverDelegate.js';\nimport { IObjectTreeElement, ObjectTreeElementCollapseState } from '../../../../base/browser/ui/tree/tree.js';\nimport { IIdentityProvider } from '../../../../base/browser/ui/list/list.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { IInstantiationService } from '../../../instantiation/common/instantiation.js';\nimport { WorkbenchObjectTree } from '../../../list/browser/listService.js';\nimport { IQuickTreeCheckboxEvent, IQuickTreeItem, IQuickTreeItemButtonEvent, QuickPickFocus } from '../../common/quickInput.js';\nimport { QuickInputTreeDelegate } from './quickInputDelegate.js';\nimport { getParentNodeState, IQuickTreeFilterData } from './quickInputTree.js';\nimport { QuickTreeAccessibilityProvider } from './quickInputTreeAccessibilityProvider.js';\nimport { QuickInputTreeFilter } from './quickInputTreeFilter.js';\nimport { QuickInputCheckboxStateHandler, QuickInputTreeRenderer } from './quickInputTreeRenderer.js';\nimport { QuickInputTreeSorter } from './quickInputTreeSorter.js';\nimport { Checkbox } from '../../../../base/browser/ui/toggle/toggle.js';\nimport { IQuickInputStyles } from '../quickInput.js';\n\nconst $ = dom.$;\nconst flatHierarchyClass = 'quick-input-tree-flat';\n\nclass QuickInputTreeIdentityProvider implements IIdentityProvider<IQuickTreeItem> {\n\tprivate readonly _elementIds = new WeakMap<IQuickTreeItem, string>();\n\tprivate _counter = 0;\n\n\tgetId(element: IQuickTreeItem): { toString(): string } {\n\t\tlet id = element.id;\n\t\tif (id !== undefined) {\n\t\t\treturn id;\n\t\t}\n\n\t\tid = this._elementIds.get(element);\n\t\tif (id !== undefined) {\n\t\t\treturn id;\n\t\t}\n\n\t\tid = `__generated_${this._counter++}`;\n\t\tthis._elementIds.set(element, id);\n\t\treturn id;\n\t}\n}\n\nexport class QuickInputTreeController extends Disposable {\n\tprivate readonly _renderer: QuickInputTreeRenderer<IQuickTreeItem>;\n\tprivate readonly _checkboxStateHandler: QuickInputCheckboxStateHandler<IQuickTreeItem>;\n\tprivate readonly _filter: QuickInputTreeFilter;\n\tprivate readonly _sorter: QuickInputTreeSorter;\n\tprivate readonly _tree: WorkbenchObjectTree<IQuickTreeItem, IQuickTreeFilterData>;\n\n\tprivate readonly _onDidTriggerButton = this._register(new Emitter<IQuickTreeItemButtonEvent<IQuickTreeItem>>());\n\n\tprivate readonly _onDidChangeCheckboxState = this._register(new Emitter<IQuickTreeCheckboxEvent<IQuickTreeItem>>());\n\treadonly onDidChangeCheckboxState = this._onDidChangeCheckboxState.event;\n\n\tprivate readonly _onDidCheckedLeafItemsChange = this._register(new Emitter<ReadonlyArray<IQuickTreeItem>>());\n\treadonly onDidChangeCheckedLeafItems = this._onDidCheckedLeafItemsChange.event;\n\n\tprivate readonly _onLeave = new Emitter<void>();\n\t/**\n\t * Event that is fired when the tree would no longer have focus.\n\t*/\n\treadonly onLeave: Event<void> = this._onLeave.event;\n\n\tprivate readonly _onDidAccept = this._register(new Emitter<void>());\n\t/**\n\t * Event that is fired when a non-pickable item is clicked, indicating acceptance.\n\t */\n\treadonly onDidAccept: Event<void> = this._onDidAccept.event;\n\n\tprivate readonly _container: HTMLElement;\n\n\tconstructor(\n\t\tcontainer: HTMLElement,\n\t\thoverDelegate: IHoverDelegate | undefined,\n\t\tstyles: IQuickInputStyles,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\t\tthis._container = dom.append(container, $('.quick-input-tree'));\n\t\tthis._checkboxStateHandler = this._register(new QuickInputCheckboxStateHandler<IQuickTreeItem>());\n\t\tthis._renderer = this._register(this.instantiationService.createInstance(\n\t\t\tQuickInputTreeRenderer,\n\t\t\thoverDelegate,\n\t\t\tthis._onDidTriggerButton,\n\t\t\tthis.onDidChangeCheckboxState,\n\t\t\tthis._checkboxStateHandler,\n\t\t\tstyles.toggle\n\t\t));\n\t\tthis._filter = this.instantiationService.createInstance(QuickInputTreeFilter);\n\t\tthis._sorter = this._register(new QuickInputTreeSorter());\n\t\tthis._tree = this._register(this.instantiationService.createInstance(\n\t\t\tWorkbenchObjectTree<IQuickTreeItem, IQuickTreeFilterData>,\n\t\t\t'QuickInputTree',\n\t\t\tthis._container,\n\t\t\tnew QuickInputTreeDelegate(),\n\t\t\t[this._renderer],\n\t\t\t{\n\t\t\t\taccessibilityProvider: new QuickTreeAccessibilityProvider(this.onDidChangeCheckboxState),\n\t\t\t\thorizontalScrolling: false,\n\t\t\t\tmultipleSelectionSupport: false,\n\t\t\t\tfindWidgetEnabled: false,\n\t\t\t\talwaysConsumeMouseWheel: true,\n\t\t\t\thideTwistiesOfChildlessElements: true,\n\t\t\t\trenderIndentGuides: RenderIndentGuides.None,\n\t\t\t\texpandOnDoubleClick: true,\n\t\t\t\texpandOnlyOnTwistieClick: true,\n\t\t\t\tdisableExpandOnSpacebar: true,\n\t\t\t\tsorter: this._sorter,\n\t\t\t\tfilter: this._filter,\n\t\t\t\tidentityProvider: new QuickInputTreeIdentityProvider()\n\t\t\t}\n\t\t));\n\t\tthis.registerCheckboxStateListeners();\n\t\tthis.registerOnDidChangeFocus();\n\t}\n\n\tget tree(): WorkbenchObjectTree<IQuickTreeItem, IQuickTreeFilterData> {\n\t\treturn this._tree;\n\t}\n\n\tget displayed() {\n\t\treturn this._container.style.display !== 'none';\n\t}\n\n\tset displayed(value: boolean) {\n\t\tthis._container.style.display = value ? '' : 'none';\n\t}\n\n\tget sortByLabel() {\n\t\treturn this._sorter.sortByLabel;\n\t}\n\n\tset sortByLabel(value: boolean) {\n\t\tthis._sorter.sortByLabel = value;\n\t\tthis._tree.resort(null, true);\n\t}\n\n\tgetActiveDescendant() {\n\t\treturn this._tree.getHTMLElement().getAttribute('aria-activedescendant');\n\t}\n\n\tfilter(input: string): void {\n\t\tthis._filter.filterValue = input;\n\t\tthis._tree.refilter();\n\t}\n\n\tupdateFilterOptions(options: {\n\t\tmatchOnLabel?: boolean;\n\t\tmatchOnDescription?: boolean;\n\t}): void {\n\t\tif (options.matchOnLabel !== undefined) {\n\t\t\tthis._filter.matchOnLabel = options.matchOnLabel;\n\t\t}\n\t\tif (options.matchOnDescription !== undefined) {\n\t\t\tthis._filter.matchOnDescription = options.matchOnDescription;\n\t\t}\n\t\tthis._tree.refilter();\n\t}\n\n\tsetTreeData(treeData: readonly IQuickTreeItem[]): void {\n\t\tlet hasNestedItems = false;\n\t\tconst createTreeElement = (item: IQuickTreeItem): IObjectTreeElement<IQuickTreeItem> => {\n\t\t\tlet children: IObjectTreeElement<IQuickTreeItem>[] | undefined;\n\t\t\tif (item.children && item.children.length > 0) {\n\t\t\t\thasNestedItems = true;\n\t\t\t\tchildren = item.children.map(child => createTreeElement(child));\n\t\t\t\titem.checked = getParentNodeState(children);\n\t\t\t}\n\t\t\treturn {\n\t\t\t\telement: item,\n\t\t\t\tchildren,\n\t\t\t\tcollapsible: !!children,\n\t\t\t\tcollapsed: item.collapsed ?\n\t\t\t\t\tObjectTreeElementCollapseState.PreserveOrCollapsed :\n\t\t\t\t\tObjectTreeElementCollapseState.PreserveOrExpanded\n\t\t\t};\n\t\t};\n\n\t\tconst treeElements = treeData.map(item => createTreeElement(item));\n\t\tthis._tree.setChildren(null, treeElements);\n\t\tthis._container.classList.toggle(flatHierarchyClass, !hasNestedItems);\n\t}\n\n\tlayout(maxHeight?: number): void {\n\t\tthis._tree.getHTMLElement().style.maxHeight = maxHeight ? `${\n\t\t\t// Make sure height aligns with list item heights\n\t\t\tMath.floor(maxHeight / 44) * 44\n\t\t\t// Add some extra height so that it's clear there's more to scroll\n\t\t\t+ 6\n\t\t\t}px` : '';\n\t\tthis._tree.layout();\n\t}\n\n\tfocus(what: QuickPickFocus): void {\n\t\tswitch (what) {\n\t\t\tcase QuickPickFocus.First:\n\t\t\t\tthis._tree.scrollTop = 0;\n\t\t\t\tthis._tree.focusFirst();\n\t\t\t\tbreak;\n\t\t\tcase QuickPickFocus.Second: {\n\t\t\t\tthis._tree.scrollTop = 0;\n\t\t\t\tlet isSecondItem = false;\n\t\t\t\tthis._tree.focusFirst(undefined, (e) => {\n\t\t\t\t\tif (isSecondItem) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tisSecondItem = !isSecondItem;\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase QuickPickFocus.Last:\n\t\t\t\tthis._tree.scrollTop = this._tree.scrollHeight;\n\t\t\t\tthis._tree.focusLast();\n\t\t\t\tbreak;\n\t\t\tcase QuickPickFocus.Next: {\n\t\t\t\tconst prevFocus = this._tree.getFocus();\n\t\t\t\tthis._tree.focusNext(undefined, false, undefined, (e) => {\n\t\t\t\t\tthis._tree.reveal(e.element);\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\t\t\t\tconst currentFocus = this._tree.getFocus();\n\t\t\t\tif (prevFocus.length && prevFocus[0] === currentFocus[0]) {\n\t\t\t\t\tthis._onLeave.fire();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase QuickPickFocus.Previous: {\n\t\t\t\tconst prevFocus = this._tree.getFocus();\n\t\t\t\tthis._tree.focusPrevious(undefined, false, undefined, (e) => {\n\t\t\t\t\t// do we want to reveal the parent?\n\t\t\t\t\tthis._tree.reveal(e.element);\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\t\t\t\tconst currentFocus = this._tree.getFocus();\n\t\t\t\tif (prevFocus.length && prevFocus[0] === currentFocus[0]) {\n\t\t\t\t\tthis._onLeave.fire();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase QuickPickFocus.NextPage:\n\t\t\t\tthis._tree.focusNextPage(undefined, (e) => {\n\t\t\t\t\tthis._tree.reveal(e.element);\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase QuickPickFocus.PreviousPage:\n\t\t\t\tthis._tree.focusPreviousPage(undefined, (e) => {\n\t\t\t\t\t// do we want to reveal the parent?\n\t\t\t\t\tthis._tree.reveal(e.element);\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase QuickPickFocus.NextSeparator:\n\t\t\tcase QuickPickFocus.PreviousSeparator:\n\t\t\t\t// These don't make sense for the tree\n\t\t\t\treturn;\n\t\t}\n\t}\n\n\tregisterCheckboxStateListeners() {\n\t\tthis._register(this._tree.onDidOpen(e => {\n\t\t\tconst item = e.element;\n\t\t\tif (!item) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (item.disabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Check if the item is pickable (defaults to true if not specified)\n\t\t\tif (item.pickable === false) {\n\t\t\t\t// For non-pickable items, set it as the active item and fire the accept event\n\t\t\t\tthis._tree.setFocus([item]);\n\t\t\t\tthis._onDidAccept.fire();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst target = e.browserEvent?.target as HTMLElement | undefined;\n\t\t\tif (target && target.classList.contains(Checkbox.CLASS_NAME)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.updateCheckboxState(item, item.checked === true);\n\t\t}));\n\n\t\tthis._register(this._checkboxStateHandler.onDidChangeCheckboxState(e => {\n\t\t\tthis.updateCheckboxState(e.item, e.checked === true);\n\t\t}));\n\t}\n\n\tprivate updateCheckboxState(item: IQuickTreeItem, newState: boolean): void {\n\t\tif ((item.checked ?? false) === newState) {\n\t\t\treturn; // No change\n\t\t}\n\n\t\t// Handle checked item\n\t\titem.checked = newState;\n\t\tthis._tree.rerender(item);\n\n\t\t// Handle children of the checked item\n\t\tconst updateSet = new Set<IQuickTreeItem>();\n\t\tconst toUpdate = [...this._tree.getNode(item).children];\n\t\twhile (toUpdate.length) {\n\t\t\tconst pop = toUpdate.shift();\n\t\t\tif (pop?.element && !updateSet.has(pop.element)) {\n\t\t\t\tupdateSet.add(pop.element);\n\t\t\t\tif ((pop.element.checked ?? false) !== item.checked) {\n\t\t\t\t\tpop.element.checked = item.checked;\n\t\t\t\t\tthis._tree.rerender(pop.element);\n\t\t\t\t}\n\t\t\t\ttoUpdate.push(...pop.children);\n\t\t\t}\n\t\t}\n\n\t\t// Handle parents of the checked item\n\t\tlet parent = this._tree.getParentElement(item);\n\t\twhile (parent) {\n\t\t\tconst parentChildren = [...this._tree.getNode(parent).children];\n\t\t\tconst newState = getParentNodeState(parentChildren);\n\n\t\t\tif ((parent.checked ?? false) !== newState) {\n\t\t\t\tparent.checked = newState;\n\t\t\t\tthis._tree.rerender(parent);\n\t\t\t}\n\t\t\tparent = this._tree.getParentElement(parent);\n\t\t}\n\n\t\tthis._onDidChangeCheckboxState.fire({\n\t\t\titem,\n\t\t\tchecked: item.checked ?? false\n\t\t});\n\t\tthis._onDidCheckedLeafItemsChange.fire(this.getCheckedLeafItems());\n\t}\n\n\tregisterOnDidChangeFocus() {\n\t\t// Ensure that selection follows focus\n\t\tthis._register(this._tree.onDidChangeFocus(e => {\n\t\t\tconst item = this._tree.getFocus().findLast(item => item !== null);\n\t\t\tthis._tree.setSelection(item ? [item] : [], e.browserEvent);\n\t\t}));\n\t}\n\n\tgetCheckedLeafItems() {\n\t\tconst lookedAt = new Set<IQuickTreeItem>();\n\t\tconst toLookAt = [...this._tree.getNode().children];\n\t\tconst checkedItems = new Array<IQuickTreeItem>();\n\t\twhile (toLookAt.length) {\n\t\t\tconst lookAt = toLookAt.shift();\n\t\t\tif (!lookAt?.element || lookedAt.has(lookAt.element)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (lookAt.element.checked) {\n\t\t\t\tlookedAt.add(lookAt.element);\n\t\t\t\ttoLookAt.push(...lookAt.children);\n\t\t\t\tif (!lookAt.element.children) {\n\t\t\t\t\tcheckedItems.push(lookAt.element);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn checkedItems;\n\t}\n\n\tgetActiveItems(): readonly IQuickTreeItem[] {\n\t\treturn this._tree.getFocus().filter((item): item is IQuickTreeItem => item !== null);\n\t}\n\n\ttoggleCheckbox() {\n\t\tfor (const element of this.getActiveItems()) {\n\t\t\tif (element.pickable !== false && !element.disabled) {\n\t\t\t\tthis.updateCheckboxState(element, !(element.checked === true));\n\t\t\t}\n\t\t}\n\t}\n\n\tcheckAll(checked: boolean | 'mixed') {\n\t\tconst updated = new Set<IQuickTreeItem>();\n\t\tconst toUpdate = [...this._tree.getNode().children];\n\t\tlet fireCheckedChangeEvent = false;\n\t\twhile (toUpdate.length) {\n\t\t\tconst update = toUpdate.shift();\n\t\t\tif (!update?.element || updated.has(update.element)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (update.element.checked !== checked) {\n\t\t\t\tfireCheckedChangeEvent = true;\n\t\t\t\tupdate.element.checked = checked;\n\t\t\t\ttoUpdate.push(...update.children);\n\t\t\t\tupdated.add(update.element);\n\t\t\t\tthis._tree.rerender(update.element);\n\t\t\t\tthis._onDidChangeCheckboxState.fire({\n\t\t\t\t\titem: update.element,\n\t\t\t\t\tchecked: update.element.checked\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tif (fireCheckedChangeEvent) {\n\t\t\tthis._onDidCheckedLeafItemsChange.fire(this.getCheckedLeafItems());\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../base/browser/dom.js';\nimport { RenderIndentGuides } from '../../../../base/browser/ui/tree/abstractTree.js';\nimport { IHoverDelegate } from '../../../../base/browser/ui/hover/hoverDelegate.js';\nimport { IObjectTreeElement, ObjectTreeElementCollapseState } from '../../../../base/browser/ui/tree/tree.js';\nimport { IIdentityProvider } from '../../../../base/browser/ui/list/list.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { IInstantiationService } from '../../../instantiation/common/instantiation.js';\nimport { WorkbenchObjectTree } from '../../../list/browser/listService.js';\nimport { IQuickTreeCheckboxEvent, IQuickTreeItem, IQuickTreeItemButtonEvent, QuickPickFocus } from '../../common/quickInput.js';\nimport { QuickInputTreeDelegate } from './quickInputDelegate.js';\nimport { getParentNodeState, IQuickTreeFilterData } from './quickInputTree.js';\nimport { QuickTreeAccessibilityProvider } from './quickInputTreeAccessibilityProvider.js';\nimport { QuickInputTreeFilter } from './quickInputTreeFilter.js';\nimport { QuickInputCheckboxStateHandler, QuickInputTreeRenderer } from './quickInputTreeRenderer.js';\nimport { QuickInputTreeSorter } from './quickInputTreeSorter.js';\nimport { Checkbox } from '../../../../base/browser/ui/toggle/toggle.js';\nimport { IQuickInputStyles } from '../quickInput.js';\n\nconst $ = dom.$;\nconst flatHierarchyClass = 'quick-input-tree-flat';\n\nclass QuickInputTreeIdentityProvider implements IIdentityProvider<IQuickTreeItem> {\n\tprivate readonly _elementIds = new WeakMap<IQuickTreeItem, string>();\n\tprivate _counter = 0;\n\n\tgetId(element: IQuickTreeItem): { toString(): string } {\n\t\tlet id = element.id;\n\t\tif (id !== undefined) {\n\t\t\treturn id;\n\t\t}\n\n\t\tid = this._elementIds.get(element);\n\t\tif (id !== undefined) {\n\t\t\treturn id;\n\t\t}\n\n\t\tid = `__generated_${this._counter++}`;\n\t\tthis._elementIds.set(element, id);\n\t\treturn id;\n\t}\n}\n\nexport class QuickInputTreeController extends Disposable {\n\tprivate readonly _renderer: QuickInputTreeRenderer<IQuickTreeItem>;\n\tprivate readonly _checkboxStateHandler: QuickInputCheckboxStateHandler<IQuickTreeItem>;\n\tprivate readonly _filter: QuickInputTreeFilter;\n\tprivate readonly _sorter: QuickInputTreeSorter;\n\tprivate readonly _tree: WorkbenchObjectTree<IQuickTreeItem, IQuickTreeFilterData>;\n\n\tprivate readonly _onDidTriggerButton = this._register(new Emitter<IQuickTreeItemButtonEvent<IQuickTreeItem>>());\n\n\tprivate readonly _onDidChangeCheckboxState = this._register(new Emitter<IQuickTreeCheckboxEvent<IQuickTreeItem>>());\n\treadonly onDidChangeCheckboxState = this._onDidChangeCheckboxState.event;\n\n\tprivate readonly _onDidCheckedLeafItemsChange = this._register(new Emitter<ReadonlyArray<IQuickTreeItem>>());\n\treadonly onDidChangeCheckedLeafItems = this._onDidCheckedLeafItemsChange.event;\n\n\tprivate readonly _onLeave = new Emitter<void>();\n\t/**\n\t * Event that is fired when the tree would no longer have focus.\n\t*/\n\treadonly onLeave: Event<void> = this._onLeave.event;\n\n\tprivate readonly _onDidAccept = this._register(new Emitter<void>());\n\t/**\n\t * Event that is fired when a non-pickable item is clicked, indicating acceptance.\n\t */\n\treadonly onDidAccept: Event<void> = this._onDidAccept.event;\n\n\tprivate readonly _container: HTMLElement;\n\n\tconstructor(\n\t\tcontainer: HTMLElement,\n\t\thoverDelegate: IHoverDelegate | undefined,\n\t\tstyles: IQuickInputStyles,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\t\tthis._container = dom.append(container, $('.quick-input-tree'));\n\t\tthis._checkboxStateHandler = this._register(new QuickInputCheckboxStateHandler<IQuickTreeItem>());\n\t\tthis._renderer = this._register(this.instantiationService.createInstance(\n\t\t\tQuickInputTreeRenderer,\n\t\t\thoverDelegate,\n\t\t\tthis._onDidTriggerButton,\n\t\t\tthis.onDidChangeCheckboxState,\n\t\t\tthis._checkboxStateHandler,\n\t\t\tstyles.toggle\n\t\t));\n\t\tthis._filter = this.instantiationService.createInstance(QuickInputTreeFilter);\n\t\tthis._sorter = this._register(new QuickInputTreeSorter());\n\t\tthis._tree = this._register(this.instantiationService.createInstance(\n\t\t\tWorkbenchObjectTree<IQuickTreeItem, IQuickTreeFilterData>,\n\t\t\t'QuickInputTree',\n\t\t\tthis._container,\n\t\t\tnew QuickInputTreeDelegate(),\n\t\t\t[this._renderer],\n\t\t\t{\n\t\t\t\taccessibilityProvider: new QuickTreeAccessibilityProvider(this.onDidChangeCheckboxState),\n\t\t\t\thorizontalScrolling: false,\n\t\t\t\tmultipleSelectionSupport: false,\n\t\t\t\tfindWidgetEnabled: false,\n\t\t\t\talwaysConsumeMouseWheel: true,\n\t\t\t\thideTwistiesOfChildlessElements: true,\n\t\t\t\trenderIndentGuides: RenderIndentGuides.None,\n\t\t\t\texpandOnDoubleClick: true,\n\t\t\t\texpandOnlyOnTwistieClick: true,\n\t\t\t\tdisableExpandOnSpacebar: true,\n\t\t\t\tsorter: this._sorter,\n\t\t\t\tfilter: this._filter,\n\t\t\t\tidentityProvider: new QuickInputTreeIdentityProvider()\n\t\t\t}\n\t\t));\n\t\tthis.registerCheckboxStateListeners();\n\t\tthis.registerOnDidChangeFocus();\n\t}\n\n\tget tree(): WorkbenchObjectTree<IQuickTreeItem, IQuickTreeFilterData> {\n\t\treturn this._tree;\n\t}\n\n\tget displayed() {\n\t\treturn this._container.style.display !== 'none';\n\t}\n\n\tset displayed(value: boolean) {\n\t\tthis._container.style.display = value ? '' : 'none';\n\t}\n\n\tget sortByLabel() {\n\t\treturn this._sorter.sortByLabel;\n\t}\n\n\tset sortByLabel(value: boolean) {\n\t\tthis._sorter.sortByLabel = value;\n\t\tthis._tree.resort(null, true);\n\t}\n\n\tgetActiveDescendant() {\n\t\treturn this._tree.getHTMLElement().getAttribute('aria-activedescendant');\n\t}\n\n\tfilter(input: string): void {\n\t\tthis._filter.filterValue = input;\n\t\tthis._tree.refilter();\n\t}\n\n\tupdateFilterOptions(options: {\n\t\tmatchOnLabel?: boolean;\n\t\tmatchOnDescription?: boolean;\n\t}): void {\n\t\tif (options.matchOnLabel !== undefined) {\n\t\t\tthis._filter.matchOnLabel = options.matchOnLabel;\n\t\t}\n\t\tif (options.matchOnDescription !== undefined) {\n\t\t\tthis._filter.matchOnDescription = options.matchOnDescription;\n\t\t}\n\t\tthis._tree.refilter();\n\t}\n\n\tsetTreeData(treeData: readonly IQuickTreeItem[]): void {\n\t\tlet hasNestedItems = false;\n\t\tconst createTreeElement = (item: IQuickTreeItem): IObjectTreeElement<IQuickTreeItem> => {\n\t\t\tlet children: IObjectTreeElement<IQuickTreeItem>[] | undefined;\n\t\t\tif (item.children && item.children.length > 0) {\n\t\t\t\thasNestedItems = true;\n\t\t\t\tchildren = item.children.map(child => createTreeElement(child));\n\t\t\t\titem.checked = getParentNodeState(children);\n\t\t\t}\n\t\t\treturn {\n\t\t\t\telement: item,\n\t\t\t\tchildren,\n\t\t\t\tcollapsible: !!children,\n\t\t\t\tcollapsed: item.collapsed ?\n\t\t\t\t\tObjectTreeElementCollapseState.PreserveOrCollapsed :\n\t\t\t\t\tObjectTreeElementCollapseState.PreserveOrExpanded\n\t\t\t};\n\t\t};\n\n\t\tconst treeElements = treeData.map(item => createTreeElement(item));\n\t\tthis._tree.setChildren(null, treeElements);\n\t\tthis._container.classList.toggle(flatHierarchyClass, !hasNestedItems);\n\t}\n\n\tlayout(maxHeight?: number): void {\n\t\tthis._tree.getHTMLElement().style.maxHeight = maxHeight ? `${\n\t\t\t// Make sure height aligns with list item heights\n\t\t\tMath.floor(maxHeight / 44) * 44\n\t\t\t// Add some extra height so that it's clear there's more to scroll\n\t\t\t+ 6\n\t\t\t}px` : '';\n\t\tthis._tree.layout();\n\t}\n\n\tfocus(what: QuickPickFocus): void {\n\t\tswitch (what) {\n\t\t\tcase QuickPickFocus.First:\n\t\t\t\tthis._tree.scrollTop = 0;\n\t\t\t\tthis._tree.focusFirst();\n\t\t\t\tbreak;\n\t\t\tcase QuickPickFocus.Second: {\n\t\t\t\tthis._tree.scrollTop = 0;\n\t\t\t\tlet isSecondItem = false;\n\t\t\t\tthis._tree.focusFirst(undefined, (e) => {\n\t\t\t\t\tif (isSecondItem) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tisSecondItem = !isSecondItem;\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase QuickPickFocus.Last:\n\t\t\t\tthis._tree.scrollTop = this._tree.scrollHeight;\n\t\t\t\tthis._tree.focusLast();\n\t\t\t\tbreak;\n\t\t\tcase QuickPickFocus.Next: {\n\t\t\t\tconst prevFocus = this._tree.getFocus();\n\t\t\t\tthis._tree.focusNext(undefined, false, undefined, (e) => {\n\t\t\t\t\tthis._tree.reveal(e.element);\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\t\t\t\tconst currentFocus = this._tree.getFocus();\n\t\t\t\tif (prevFocus.length && prevFocus[0] === currentFocus[0]) {\n\t\t\t\t\tthis._onLeave.fire();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase QuickPickFocus.Previous: {\n\t\t\t\tconst prevFocus = this._tree.getFocus();\n\t\t\t\tthis._tree.focusPrevious(undefined, false, undefined, (e) => {\n\t\t\t\t\t// do we want to reveal the parent?\n\t\t\t\t\tthis._tree.reveal(e.element);\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\t\t\t\tconst currentFocus = this._tree.getFocus();\n\t\t\t\tif (prevFocus.length && prevFocus[0] === currentFocus[0]) {\n\t\t\t\t\tthis._onLeave.fire();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase QuickPickFocus.NextPage:\n\t\t\t\tthis._tree.focusNextPage(undefined, (e) => {\n\t\t\t\t\tthis._tree.reveal(e.element);\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase QuickPickFocus.PreviousPage:\n\t\t\t\tthis._tree.focusPreviousPage(undefined, (e) => {\n\t\t\t\t\t// do we want to reveal the parent?\n\t\t\t\t\tthis._tree.reveal(e.element);\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase QuickPickFocus.NextSeparator:\n\t\t\tcase QuickPickFocus.PreviousSeparator:\n\t\t\t\t// These don't make sense for the tree\n\t\t\t\treturn;\n\t\t}\n\t}\n\n\tregisterCheckboxStateListeners() {\n\t\tthis._register(this._tree.onDidOpen(e => {\n\t\t\tconst item = e.element;\n\t\t\tif (!item) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (item.disabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Check if the item is pickable (defaults to true if not specified)\n\t\t\tif (item.pickable === false) {\n\t\t\t\t// For non-pickable items, set it as the active item and fire the accept event\n\t\t\t\tthis._tree.setFocus([item]);\n\t\t\t\tthis._onDidAccept.fire();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst target = e.browserEvent?.target as HTMLElement | undefined;\n\t\t\tif (target && target.classList.contains(Checkbox.CLASS_NAME)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.updateCheckboxState(item, item.checked === true);\n\t\t}));\n\n\t\tthis._register(this._checkboxStateHandler.onDidChangeCheckboxState(e => {\n\t\t\tthis.updateCheckboxState(e.item, e.checked === true);\n\t\t}));\n\t}\n\n\tprivate updateCheckboxState(item: IQuickTreeItem, newState: boolean): void {\n\t\tif ((item.checked ?? false) === newState) {\n\t\t\treturn; // No change\n\t\t}\n\n\t\t// Handle checked item\n\t\titem.checked = newState;\n\t\tthis._tree.rerender(item);\n\n\t\t// Handle children of the checked item\n\t\tconst updateSet = new Set<IQuickTreeItem>();\n\t\tconst toUpdate = [...this._tree.getNode(item).children];\n\t\twhile (toUpdate.length) {\n\t\t\tconst pop = toUpdate.shift();\n\t\t\tif (pop?.element && !updateSet.has(pop.element)) {\n\t\t\t\tupdateSet.add(pop.element);\n\t\t\t\tif ((pop.element.checked ?? false) !== item.checked) {\n\t\t\t\t\tpop.element.checked = item.checked;\n\t\t\t\t\tthis._tree.rerender(pop.element);\n\t\t\t\t}\n\t\t\t\ttoUpdate.push(...pop.children);\n\t\t\t}\n\t\t}\n\n\t\t// Handle parents of the checked item\n\t\tlet parent = this._tree.getParentElement(item);\n\t\twhile (parent) {\n\t\t\tconst parentChildren = [...this._tree.getNode(parent).children];\n\t\t\tconst newState = getParentNodeState(parentChildren);\n\n\t\t\tif ((parent.checked ?? false) !== newState) {\n\t\t\t\tparent.checked = newState;\n\t\t\t\tthis._tree.rerender(parent);\n\t\t\t}\n\t\t\tparent = this._tree.getParentElement(parent);\n\t\t}\n\n\t\tthis._onDidChangeCheckboxState.fire({\n\t\t\titem,\n\t\t\tchecked: item.checked ?? false\n\t\t});\n\t\tthis._onDidCheckedLeafItemsChange.fire(this.getCheckedLeafItems());\n\t}\n\n\tregisterOnDidChangeFocus() {\n\t\t// Ensure that selection follows focus\n\t\tthis._register(this._tree.onDidChangeFocus(e => {\n\t\t\tconst item = this._tree.getFocus().findLast(item => item !== null);\n\t\t\tthis._tree.setSelection(item ? [item] : [], e.browserEvent);\n\t\t}));\n\t}\n\n\tgetCheckedLeafItems() {\n\t\tconst lookedAt = new Set<IQuickTreeItem>();\n\t\tconst toLookAt = [...this._tree.getNode().children];\n\t\tconst checkedItems = new Array<IQuickTreeItem>();\n\t\twhile (toLookAt.length) {\n\t\t\tconst lookAt = toLookAt.shift();\n\t\t\tif (!lookAt?.element || lookedAt.has(lookAt.element)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (lookAt.element.checked) {\n\t\t\t\tlookedAt.add(lookAt.element);\n\t\t\t\ttoLookAt.push(...lookAt.children);\n\t\t\t\tif (!lookAt.element.children) {\n\t\t\t\t\tcheckedItems.push(lookAt.element);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn checkedItems;\n\t}\n\n\tgetActiveItems(): readonly IQuickTreeItem[] {\n\t\treturn this._tree.getFocus().filter((item): item is IQuickTreeItem => item !== null);\n\t}\n\n\ttoggleCheckbox() {\n\t\tfor (const element of this.getActiveItems()) {\n\t\t\tif (element.pickable !== false && !element.disabled) {\n\t\t\t\tthis.updateCheckboxState(element, !(element.checked === true));\n\t\t\t}\n\t\t}\n\t}\n\n\tcheckAll(checked: boolean | 'mixed') {\n\t\tconst updated = new Set<IQuickTreeItem>();\n\t\tconst toUpdate = [...this._tree.getNode().children];\n\t\tlet fireCheckedChangeEvent = false;\n\t\twhile (toUpdate.length) {\n\t\t\tconst update = toUpdate.shift();\n\t\t\tif (!update?.element || updated.has(update.element)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (update.element.checked !== checked) {\n\t\t\t\tfireCheckedChangeEvent = true;\n\t\t\t\tupdate.element.checked = checked;\n\t\t\t\ttoUpdate.push(...update.children);\n\t\t\t\tupdated.add(update.element);\n\t\t\t\tthis._tree.rerender(update.element);\n\t\t\t\tthis._onDidChangeCheckboxState.fire({\n\t\t\t\t\titem: update.element,\n\t\t\t\t\tchecked: update.element.checked\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tif (fireCheckedChangeEvent) {\n\t\t\tthis._onDidCheckedLeafItemsChange.fire(this.getCheckedLeafItems());\n\t\t}\n\t}\n}\n"]}