{"version":3,"sources":["file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src/vs/editor/contrib/inlineCompletions/browser/model/textModelValueReference.ts","vs/editor/contrib/inlineCompletions/browser/model/textModelValueReference.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAEhG,OAAO,EAAE,iBAAiB,EAAE,MAAM,sCAAsC,CAAC;AAIzE,OAAO,EAAE,YAAY,EAAE,MAAM,8CAA8C,CAAC;AAC5E,OAAO,EAAE,UAAU,EAAE,MAAM,4CAA4C,CAAC;AAGxE;;;;;GAKG;AACH,MAAM,OAAO,uBAAwB,SAAQ,YAAY;IAGxD,MAAM,CAAC,QAAQ,CAAC,SAAqB;QACpC,OAAO,IAAI,uBAAuB,CAAC,SAAS,CAAC,CAAC;IAC/C,CAAC;IAED,YAAqC,UAAsB;QAC1D,KAAK,EAAE,CAAC;QAD4B,eAAU,GAAV,UAAU,CAAY;QAE1D,IAAI,CAAC,QAAQ,GAAG,UAAU,CAAC,YAAY,EAAE,CAAC;IAC3C,CAAC;IAED,IAAI,GAAG;QACN,OAAO,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC;IAC5B,CAAC;IAEO,YAAY;QACnB,IAAI,IAAI,CAAC,UAAU,CAAC,YAAY,EAAE,KAAK,IAAI,CAAC,QAAQ,EAAE,CAAC;YACtD,iBAAiB,CAAC,IAAI,KAAK,CAAC,2CAA2C,IAAI,CAAC,QAAQ,SAAS,IAAI,CAAC,UAAU,CAAC,YAAY,EAAE,EAAE,CAAC,CAAC,CAAC;YAChI,oBAAoB;QACrB,CAAC;IACF,CAAC;IAED,OAAO,CAAC,SAAqB;QAC5B,OAAO,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,QAAQ,EAAE,KAAK,SAAS,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC;IACpE,CAAC;IAEQ,eAAe,CAAC,KAAY;QACpC,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,OAAO,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;IAC/C,CAAC;IAEQ,aAAa,CAAC,UAAkB;QACxC,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,OAAO,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;IAClD,CAAC;IAED,IAAI,MAAM;QACT,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,MAAM,cAAc,GAAG,IAAI,CAAC,UAAU,CAAC,YAAY,EAAE,CAAC;QACtD,MAAM,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,cAAc,CAAC,CAAC;QAClE,OAAO,IAAI,UAAU,CAAC,cAAc,GAAG,CAAC,EAAE,WAAW,CAAC,CAAC;IACxD,CAAC;IAED,MAAM;QACL,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,OAAO,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC;IACjC,CAAC;IAED,aAAa,CAAC,MAAc;QAC3B,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,OAAO,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;IAC9C,CAAC;IAED,eAAe,CAAC,KAAY;QAC3B,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,OAAO,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;IAC/C,CAAC;IAED,YAAY;QACX,OAAO,IAAI,CAAC,QAAQ,CAAC;IACtB,CAAC;IAED,6BAA6B;QAC5B,OAAO,IAAI,CAAC,UAAU,CAAC;IACxB,CAAC;CACD","file":"textModelValueReference.js","sourceRoot":"file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { onUnexpectedError } from '../../../../../base/common/errors.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { Position } from '../../../../common/core/position.js';\nimport { Range } from '../../../../common/core/range.js';\nimport { AbstractText } from '../../../../common/core/text/abstractText.js';\nimport { TextLength } from '../../../../common/core/text/textLength.js';\nimport { ITextModel } from '../../../../common/model.js';\n\n/**\n * An immutable view of a text model at a specific version.\n * Like TextModelText but throws if the underlying model has changed.\n * This ensures data read from the reference is consistent with\n * the version at construction time.\n */\nexport class TextModelValueReference extends AbstractText {\n\tprivate readonly _version: number;\n\n\tstatic snapshot(textModel: ITextModel): TextModelValueReference {\n\t\treturn new TextModelValueReference(textModel);\n\t}\n\n\tprivate constructor(private readonly _textModel: ITextModel) {\n\t\tsuper();\n\t\tthis._version = _textModel.getVersionId();\n\t}\n\n\tget uri(): URI {\n\t\treturn this._textModel.uri;\n\t}\n\n\tprivate _assertValid(): void {\n\t\tif (this._textModel.getVersionId() !== this._version) {\n\t\t\tonUnexpectedError(new Error(`TextModel has changed: expected version ${this._version}, got ${this._textModel.getVersionId()}`));\n\t\t\t// TODO: throw here!\n\t\t}\n\t}\n\n\ttargets(textModel: ITextModel): boolean {\n\t\treturn this._textModel.uri.toString() === textModel.uri.toString();\n\t}\n\n\toverride getValueOfRange(range: Range): string {\n\t\tthis._assertValid();\n\t\treturn this._textModel.getValueInRange(range);\n\t}\n\n\toverride getLineLength(lineNumber: number): number {\n\t\tthis._assertValid();\n\t\treturn this._textModel.getLineLength(lineNumber);\n\t}\n\n\tget length(): TextLength {\n\t\tthis._assertValid();\n\t\tconst lastLineNumber = this._textModel.getLineCount();\n\t\tconst lastLineLen = this._textModel.getLineLength(lastLineNumber);\n\t\treturn new TextLength(lastLineNumber - 1, lastLineLen);\n\t}\n\n\tgetEOL(): string {\n\t\tthis._assertValid();\n\t\treturn this._textModel.getEOL();\n\t}\n\n\tgetPositionAt(offset: number): Position {\n\t\tthis._assertValid();\n\t\treturn this._textModel.getPositionAt(offset);\n\t}\n\n\tgetValueInRange(range: Range): string {\n\t\tthis._assertValid();\n\t\treturn this._textModel.getValueInRange(range);\n\t}\n\n\tgetVersionId(): number {\n\t\treturn this._version;\n\t}\n\n\tdangerouslyGetUnderlyingModel(): ITextModel {\n\t\treturn this._textModel;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { onUnexpectedError } from '../../../../../base/common/errors.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { Position } from '../../../../common/core/position.js';\nimport { Range } from '../../../../common/core/range.js';\nimport { AbstractText } from '../../../../common/core/text/abstractText.js';\nimport { TextLength } from '../../../../common/core/text/textLength.js';\nimport { ITextModel } from '../../../../common/model.js';\n\n/**\n * An immutable view of a text model at a specific version.\n * Like TextModelText but throws if the underlying model has changed.\n * This ensures data read from the reference is consistent with\n * the version at construction time.\n */\nexport class TextModelValueReference extends AbstractText {\n\tprivate readonly _version: number;\n\n\tstatic snapshot(textModel: ITextModel): TextModelValueReference {\n\t\treturn new TextModelValueReference(textModel);\n\t}\n\n\tprivate constructor(private readonly _textModel: ITextModel) {\n\t\tsuper();\n\t\tthis._version = _textModel.getVersionId();\n\t}\n\n\tget uri(): URI {\n\t\treturn this._textModel.uri;\n\t}\n\n\tprivate _assertValid(): void {\n\t\tif (this._textModel.getVersionId() !== this._version) {\n\t\t\tonUnexpectedError(new Error(`TextModel has changed: expected version ${this._version}, got ${this._textModel.getVersionId()}`));\n\t\t\t// TODO: throw here!\n\t\t}\n\t}\n\n\ttargets(textModel: ITextModel): boolean {\n\t\treturn this._textModel.uri.toString() === textModel.uri.toString();\n\t}\n\n\toverride getValueOfRange(range: Range): string {\n\t\tthis._assertValid();\n\t\treturn this._textModel.getValueInRange(range);\n\t}\n\n\toverride getLineLength(lineNumber: number): number {\n\t\tthis._assertValid();\n\t\treturn this._textModel.getLineLength(lineNumber);\n\t}\n\n\tget length(): TextLength {\n\t\tthis._assertValid();\n\t\tconst lastLineNumber = this._textModel.getLineCount();\n\t\tconst lastLineLen = this._textModel.getLineLength(lastLineNumber);\n\t\treturn new TextLength(lastLineNumber - 1, lastLineLen);\n\t}\n\n\tgetEOL(): string {\n\t\tthis._assertValid();\n\t\treturn this._textModel.getEOL();\n\t}\n\n\tgetPositionAt(offset: number): Position {\n\t\tthis._assertValid();\n\t\treturn this._textModel.getPositionAt(offset);\n\t}\n\n\tgetValueInRange(range: Range): string {\n\t\tthis._assertValid();\n\t\treturn this._textModel.getValueInRange(range);\n\t}\n\n\tgetVersionId(): number {\n\t\treturn this._version;\n\t}\n\n\tdangerouslyGetUnderlyingModel(): ITextModel {\n\t\treturn this._textModel;\n\t}\n}\n"]}