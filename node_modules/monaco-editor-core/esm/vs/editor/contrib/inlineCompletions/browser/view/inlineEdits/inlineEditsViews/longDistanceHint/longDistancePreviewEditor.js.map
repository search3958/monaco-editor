{"version":3,"sources":["file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src/vs/editor/contrib/inlineCompletions/browser/view/inlineEdits/inlineEditsViews/longDistanceHint/longDistancePreviewEditor.ts","vs/editor/contrib/inlineCompletions/browser/view/inlineEdits/inlineEditsViews/longDistanceHint/longDistancePreviewEditor.ts"],"names":[],"mappings":"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","file":"longDistancePreviewEditor.js","sourceRoot":"file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { n } from '../../../../../../../../base/browser/dom.js';\nimport { Disposable } from '../../../../../../../../base/common/lifecycle.js';\nimport { clamp } from '../../../../../../../../base/common/numbers.js';\nimport { IObservable, derived, constObservable, IReader, autorun, observableValue } from '../../../../../../../../base/common/observable.js';\nimport { IInstantiationService } from '../../../../../../../../platform/instantiation/common/instantiation.js';\nimport { ICodeEditor } from '../../../../../../../browser/editorBrowser.js';\nimport { ObservableCodeEditor, observableCodeEditor } from '../../../../../../../browser/observableCodeEditor.js';\nimport { EmbeddedCodeEditorWidget } from '../../../../../../../browser/widget/codeEditor/embeddedCodeEditorWidget.js';\nimport { IDimension } from '../../../../../../../common/core/2d/dimension.js';\nimport { Position } from '../../../../../../../common/core/position.js';\nimport { Range } from '../../../../../../../common/core/range.js';\nimport { LineRange } from '../../../../../../../common/core/ranges/lineRange.js';\nimport { OffsetRange } from '../../../../../../../common/core/ranges/offsetRange.js';\nimport { DetailedLineRangeMapping } from '../../../../../../../common/diff/rangeMapping.js';\nimport { IModelDeltaDecoration, ITextModel } from '../../../../../../../common/model.js';\nimport { ModelDecorationOptions } from '../../../../../../../common/model/textModel.js';\nimport { InlineCompletionContextKeys } from '../../../../controller/inlineCompletionContextKeys.js';\nimport { InlineEditsGutterIndicator, InlineEditsGutterIndicatorData, InlineSuggestionGutterMenuData, SimpleInlineSuggestModel } from '../../components/gutterIndicatorView.js';\nimport { InlineEditTabAction } from '../../inlineEditsViewInterface.js';\nimport { classNames, maxContentWidthInRange } from '../../utils/utils.js';\nimport { JumpToView } from '../jumpToView.js';\nimport { TextModelValueReference } from '../../../../model/textModelValueReference.js';\n\nexport interface ILongDistancePreviewProps {\n\tnextCursorPosition: Position | null; // assert: nextCursorPosition !== null  xor  diff.length > 0\n\tdiff: DetailedLineRangeMapping[];\n\tmodel: SimpleInlineSuggestModel;\n\tinlineSuggestInfo: InlineSuggestionGutterMenuData;\n\t/**\n\t * The URI of the file the edit targets.\n\t * When undefined (or same as the editor's model URI), the edit targets the current file.\n\t */\n\ttarget: TextModelValueReference;\n}\n\nexport class LongDistancePreviewEditor extends Disposable {\n\tpublic readonly previewEditor;\n\tprivate readonly _previewEditorObs;\n\n\tprivate readonly _previewRef = n.ref<HTMLDivElement>();\n\tpublic readonly element = n.div({ class: 'preview', style: { /*pointerEvents: 'none'*/ }, ref: this._previewRef });\n\n\tprivate _parentEditorObs: ObservableCodeEditor;\n\n\tconstructor(\n\t\tprivate readonly _previewTextModel: ITextModel,\n\t\tprivate readonly _properties: IObservable<ILongDistancePreviewProps | undefined>,\n\t\tprivate readonly _parentEditor: ICodeEditor,\n\t\tprivate readonly _tabAction: IObservable<InlineEditTabAction>,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis.previewEditor = this._register(this._createPreviewEditor());\n\t\tthis._parentEditorObs = observableCodeEditor(this._parentEditor);\n\n\t\tthis._register(autorun(reader => {\n\t\t\tconst tm = this._state.read(reader)?.textModel || null;\n\n\t\t\tif (tm) {\n\t\t\t\t// Avoid transitions from tm -> null -> tm, where tm -> tm would be a no-op.\n\t\t\t\tthis.previewEditor.setModel(tm.dangerouslyGetUnderlyingModel());\n\t\t\t}\n\t\t}));\n\n\t\tthis._previewEditorObs = observableCodeEditor(this.previewEditor);\n\t\tthis._register(this._previewEditorObs.setDecorations(derived(reader => {\n\t\t\tconst state = this._state.read(reader);\n\t\t\tconst decorations = this._editorDecorations.read(reader);\n\t\t\treturn (state?.mode === 'original' ? decorations?.originalDecorations : decorations?.modifiedDecorations) ?? [];\n\t\t})));\n\n\t\tconst showJumpToDecoration = false;\n\n\t\tif (showJumpToDecoration) {\n\t\t\tthis._register(this._instantiationService.createInstance(JumpToView, this._previewEditorObs, { style: 'cursor' }, derived(reader => {\n\t\t\t\tconst p = this._properties.read(reader);\n\t\t\t\tif (!p || !p.nextCursorPosition) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tjumpToPosition: p.nextCursorPosition,\n\n\t\t\t\t};\n\t\t\t})));\n\t\t}\n\n\t\t// Mirror the cursor position. Allows the gutter arrow to point in the correct direction.\n\t\tthis._register(autorun((reader) => {\n\t\t\tif (!this._properties.read(reader)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst cursorPosition = this._parentEditorObs.cursorPosition.read(reader);\n\t\t\tif (cursorPosition) {\n\t\t\t\tthis.previewEditor.setPosition(this._previewTextModel.validatePosition(cursorPosition), 'longDistanceHintPreview');\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(autorun(reader => {\n\t\t\tconst state = this._state.read(reader);\n\t\t\tif (!state) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Ensure there is enough space to the left of the line number for the gutter indicator to fits.\n\t\t\tconst lineNumberDigets = state.visibleLineRange.startLineNumber.toString().length;\n\t\t\tthis.previewEditor.updateOptions({ lineNumbersMinChars: lineNumberDigets + 1 });\n\t\t}));\n\n\t\tthis._register(this._instantiationService.createInstance(\n\t\t\tInlineEditsGutterIndicator,\n\t\t\tthis._previewEditorObs,\n\t\t\tderived(reader => {\n\t\t\t\tconst state = this._state.read(reader);\n\t\t\t\tif (!state) { return undefined; }\n\t\t\t\tconst props = this._properties.read(reader);\n\t\t\t\tif (!props) { return undefined; }\n\t\t\t\treturn new InlineEditsGutterIndicatorData(\n\t\t\t\t\tprops.inlineSuggestInfo,\n\t\t\t\t\tLineRange.ofLength(state.visibleLineRange.startLineNumber, 1),\n\t\t\t\t\tprops.model,\n\t\t\t\t\tundefined,\n\t\t\t\t);\n\t\t\t}),\n\t\t\tthis._tabAction,\n\t\t\tconstObservable(0),\n\t\t\tconstObservable(false),\n\t\t\tobservableValue(this, false),\n\t\t));\n\n\t\tthis.updatePreviewEditorEffect.recomputeInitiallyAndOnChange(this._store);\n\t}\n\n\tprivate readonly _state = derived<{\n\t\tmode: 'original' | 'modified';\n\t\tvisibleLineRange: LineRange;\n\t\ttextModel: TextModelValueReference | undefined;\n\t\tdiff: DetailedLineRangeMapping[];\n\t} | undefined>(this, reader => {\n\t\tconst props = this._properties.read(reader);\n\t\tif (!props) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tlet mode: 'original' | 'modified';\n\t\tlet visibleRange: LineRange;\n\n\t\tif (props.nextCursorPosition !== null) {\n\t\t\tmode = 'original';\n\t\t\tvisibleRange = LineRange.ofLength(props.nextCursorPosition.lineNumber, 1);\n\t\t} else {\n\t\t\tif (props.diff[0].innerChanges?.every(c => c.modifiedRange.isEmpty())) {\n\t\t\t\tmode = 'original';\n\t\t\t\tvisibleRange = LineRange.ofLength(props.diff[0].original.startLineNumber, 1);\n\t\t\t} else {\n\t\t\t\tmode = 'modified';\n\t\t\t\tvisibleRange = LineRange.ofLength(props.diff[0].modified.startLineNumber, 1);\n\t\t\t}\n\t\t}\n\n\t\tconst textModel = mode === 'modified'\n\t\t\t? TextModelValueReference.snapshot(this._previewTextModel)\n\t\t\t: props.target;\n\n\t\treturn {\n\t\t\tmode,\n\t\t\tvisibleLineRange: visibleRange,\n\t\t\ttextModel,\n\t\t\tdiff: props.diff,\n\t\t};\n\t});\n\n\tprivate _createPreviewEditor() {\n\t\treturn this._instantiationService.createInstance(\n\t\t\tEmbeddedCodeEditorWidget,\n\t\t\tthis._previewRef.element,\n\t\t\t{\n\t\t\t\tglyphMargin: false,\n\t\t\t\tlineNumbers: 'on',\n\t\t\t\tminimap: { enabled: false },\n\t\t\t\tguides: {\n\t\t\t\t\tindentation: false,\n\t\t\t\t\tbracketPairs: false,\n\t\t\t\t\tbracketPairsHorizontal: false,\n\t\t\t\t\thighlightActiveIndentation: false,\n\t\t\t\t},\n\t\t\t\teditContext: false, // is a bit faster\n\t\t\t\trulers: [],\n\t\t\t\tpadding: { top: 0, bottom: 0 },\n\t\t\t\t//folding: false,\n\t\t\t\tselectOnLineNumbers: false,\n\t\t\t\tselectionHighlight: false,\n\t\t\t\tcolumnSelection: false,\n\t\t\t\toverviewRulerBorder: false,\n\t\t\t\toverviewRulerLanes: 0,\n\t\t\t\t//lineDecorationsWidth: 0,\n\t\t\t\t//lineNumbersMinChars: 0,\n\t\t\t\trevealHorizontalRightPadding: 0,\n\t\t\t\tbracketPairColorization: { enabled: true, independentColorPoolPerBracketType: false },\n\t\t\t\tscrollBeyondLastLine: false,\n\t\t\t\tscrollbar: {\n\t\t\t\t\tvertical: 'hidden',\n\t\t\t\t\thorizontal: 'hidden',\n\t\t\t\t\thandleMouseWheel: false,\n\t\t\t\t},\n\t\t\t\treadOnly: true,\n\t\t\t\twordWrap: 'off',\n\t\t\t\twordWrapOverride1: 'off',\n\t\t\t\twordWrapOverride2: 'off',\n\t\t\t},\n\t\t\t{\n\t\t\t\tcontextKeyValues: {\n\t\t\t\t\t[InlineCompletionContextKeys.inInlineEditsPreviewEditor.key]: true,\n\t\t\t\t},\n\t\t\t\tcontributions: [],\n\t\t\t},\n\t\t\tthis._parentEditor\n\t\t);\n\t}\n\n\tpublic readonly updatePreviewEditorEffect = derived(this, reader => {\n\t\t// this._widgetContent.readEffect(reader);\n\t\tthis._previewEditorObs.model.read(reader); // update when the model is set\n\n\t\tconst range = this._state.read(reader)?.visibleLineRange;\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\t\tconst hiddenAreas: Range[] = [];\n\t\tif (range.startLineNumber > 1) {\n\t\t\thiddenAreas.push(new Range(1, 1, range.startLineNumber - 1, 1));\n\t\t}\n\t\tif (range.endLineNumberExclusive < this._previewTextModel.getLineCount() + 1) {\n\t\t\thiddenAreas.push(new Range(range.endLineNumberExclusive, 1, this._previewTextModel.getLineCount() + 1, 1));\n\t\t}\n\t\tthis.previewEditor.setHiddenAreas(hiddenAreas, undefined, true);\n\t});\n\n\tpublic readonly horizontalContentRangeInPreviewEditorToShow = derived(this, reader => {\n\t\treturn this._getHorizontalContentRangeInPreviewEditorToShow(this.previewEditor, reader);\n\t});\n\n\tpublic readonly contentHeight = derived(this, (reader) => {\n\t\tconst viewState = this._state.read(reader);\n\t\tif (!viewState) {\n\t\t\treturn constObservable(null);\n\t\t}\n\n\t\tconst previewEditorHeight = this._previewEditorObs.observeLineHeightForLine(viewState.visibleLineRange.startLineNumber);\n\t\treturn previewEditorHeight;\n\t}).flatten();\n\n\tprivate _getHorizontalContentRangeInPreviewEditorToShow(editor: ICodeEditor, reader: IReader) {\n\t\tconst state = this._state.read(reader);\n\t\tif (!state) { return undefined; }\n\n\t\tconst diff = state.diff;\n\t\tconst jumpToPos = this._properties.read(reader)?.nextCursorPosition;\n\n\t\tconst visibleRange = state.visibleLineRange;\n\t\tconst l = this._previewEditorObs.layoutInfo.read(reader);\n\t\tconst trueContentWidth = maxContentWidthInRange(this._previewEditorObs, visibleRange, reader);\n\n\t\tlet firstCharacterChange: Range;\n\t\tif (jumpToPos) {\n\t\t\tfirstCharacterChange = Range.fromPositions(jumpToPos);\n\t\t} else if (diff[0].innerChanges) {\n\t\t\tfirstCharacterChange = state.mode === 'modified' ? diff[0].innerChanges[0].modifiedRange : diff[0].innerChanges[0].originalRange;\n\t\t} else {\n\t\t\treturn undefined;\n\t\t}\n\n\n\t\t// find the horizontal range we want to show.\n\t\tconst preferredRange = growUntilVariableBoundaries(editor.getModel()!, firstCharacterChange, 5);\n\t\tconst leftOffset = this._previewEditorObs.getLeftOfPosition(preferredRange.getStartPosition(), reader);\n\t\tconst rightOffset = this._previewEditorObs.getLeftOfPosition(preferredRange.getEndPosition(), reader);\n\n\t\tconst left = clamp(leftOffset, 0, trueContentWidth);\n\t\tconst right = clamp(rightOffset, left, trueContentWidth);\n\n\t\tconst indentCol = editor.getModel()!.getLineFirstNonWhitespaceColumn(preferredRange.startLineNumber);\n\t\tconst indentationEnd = this._previewEditorObs.getLeftOfPosition(new Position(preferredRange.startLineNumber, indentCol), reader);\n\n\t\tconst preferredRangeToReveal = new OffsetRange(left, right);\n\n\t\treturn {\n\t\t\tindentationEnd,\n\t\t\tpreferredRangeToReveal,\n\t\t\tmaxEditorWidth: trueContentWidth + l.contentLeft,\n\t\t\tcontentWidth: trueContentWidth,\n\t\t\tnonContentWidth: l.contentLeft, // Width of area that is not content\n\t\t};\n\t}\n\n\tpublic layout(dimension: IDimension, desiredPreviewEditorScrollLeft: number): void {\n\t\tthis.previewEditor.layout(dimension);\n\t\tthis._previewEditorObs.editor.setScrollLeft(desiredPreviewEditorScrollLeft);\n\t}\n\n\tprivate readonly _editorDecorations = derived(this, reader => {\n\t\tconst state = this._state.read(reader);\n\t\tif (!state) { return undefined; }\n\n\t\tconst diff = {\n\t\t\tmode: 'insertionInline' as const,\n\t\t\tdiff: state.diff,\n\t\t};\n\t\tconst originalDecorations: IModelDeltaDecoration[] = [];\n\t\tconst modifiedDecorations: IModelDeltaDecoration[] = [];\n\n\t\tconst diffWholeLineDeleteDecoration = ModelDecorationOptions.register({\n\t\t\tclassName: 'inlineCompletions-char-delete',\n\t\t\tdescription: 'char-delete',\n\t\t\tisWholeLine: false,\n\t\t\tzIndex: 1, // be on top of diff background decoration\n\t\t});\n\n\t\tconst diffWholeLineAddDecoration = ModelDecorationOptions.register({\n\t\t\tclassName: 'inlineCompletions-char-insert',\n\t\t\tdescription: 'char-insert',\n\t\t\tisWholeLine: true,\n\t\t});\n\n\t\tconst diffAddDecoration = ModelDecorationOptions.register({\n\t\t\tclassName: 'inlineCompletions-char-insert',\n\t\t\tdescription: 'char-insert',\n\t\t\tshouldFillLineOnLineBreak: true,\n\t\t});\n\n\t\tconst hideEmptyInnerDecorations = true; // diff.mode === 'lineReplacement';\n\t\tfor (const m of diff.diff) {\n\t\t\tif (m.modified.isEmpty || m.original.isEmpty) {\n\t\t\t\tif (!m.original.isEmpty) {\n\t\t\t\t\toriginalDecorations.push({ range: m.original.toInclusiveRange()!, options: diffWholeLineDeleteDecoration });\n\t\t\t\t}\n\t\t\t\tif (!m.modified.isEmpty) {\n\t\t\t\t\tmodifiedDecorations.push({ range: m.modified.toInclusiveRange()!, options: diffWholeLineAddDecoration });\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (const i of m.innerChanges || []) {\n\t\t\t\t\t// Don't show empty markers outside the line range\n\t\t\t\t\tif (m.original.contains(i.originalRange.startLineNumber) && !(hideEmptyInnerDecorations && i.originalRange.isEmpty())) {\n\t\t\t\t\t\toriginalDecorations.push({\n\t\t\t\t\t\t\trange: i.originalRange,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tdescription: 'char-delete',\n\t\t\t\t\t\t\t\tshouldFillLineOnLineBreak: false,\n\t\t\t\t\t\t\t\tclassName: classNames(\n\t\t\t\t\t\t\t\t\t'inlineCompletions-char-delete',\n\t\t\t\t\t\t\t\t\t// i.originalRange.isSingleLine() && diff.mode === 'insertionInline' && 'single-line-inline',\n\t\t\t\t\t\t\t\t\ti.originalRange.isEmpty() && 'empty',\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\tzIndex: 1\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (m.modified.contains(i.modifiedRange.startLineNumber)) {\n\t\t\t\t\t\tmodifiedDecorations.push({\n\t\t\t\t\t\t\trange: i.modifiedRange,\n\t\t\t\t\t\t\toptions: diffAddDecoration\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn { originalDecorations, modifiedDecorations };\n\t});\n}\n\n/*\n * Grows the range on each ends until it includes a none-variable-name character\n * or the next character would be a whitespace character\n * or the maxGrow limit is reached\n */\nfunction growUntilVariableBoundaries(textModel: ITextModel, range: Range, maxGrow: number): Range {\n\tconst startPosition = range.getStartPosition();\n\tconst endPosition = range.getEndPosition();\n\tconst line = textModel.getLineContent(startPosition.lineNumber);\n\n\tfunction isVariableNameCharacter(col: number): boolean {\n\t\tconst char = line.charAt(col - 1);\n\t\treturn (/[a-zA-Z0-9_]/).test(char);\n\t}\n\n\tfunction isWhitespace(col: number): boolean {\n\t\tconst char = line.charAt(col - 1);\n\t\treturn char === ' ' || char === '\\t';\n\t}\n\n\tlet startColumn = startPosition.column;\n\twhile (startColumn > 1 && isVariableNameCharacter(startColumn) && !isWhitespace(startColumn - 1) && startPosition.column - startColumn < maxGrow) {\n\t\tstartColumn--;\n\t}\n\n\tlet endColumn = endPosition.column - 1;\n\twhile (endColumn <= line.length && isVariableNameCharacter(endColumn) && !isWhitespace(endColumn + 1) && endColumn - endPosition.column < maxGrow) {\n\t\tendColumn++;\n\t}\n\n\treturn new Range(startPosition.lineNumber, startPosition.column, endPosition.lineNumber, endColumn + 1);\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { n } from '../../../../../../../../base/browser/dom.js';\nimport { Disposable } from '../../../../../../../../base/common/lifecycle.js';\nimport { clamp } from '../../../../../../../../base/common/numbers.js';\nimport { IObservable, derived, constObservable, IReader, autorun, observableValue } from '../../../../../../../../base/common/observable.js';\nimport { IInstantiationService } from '../../../../../../../../platform/instantiation/common/instantiation.js';\nimport { ICodeEditor } from '../../../../../../../browser/editorBrowser.js';\nimport { ObservableCodeEditor, observableCodeEditor } from '../../../../../../../browser/observableCodeEditor.js';\nimport { EmbeddedCodeEditorWidget } from '../../../../../../../browser/widget/codeEditor/embeddedCodeEditorWidget.js';\nimport { IDimension } from '../../../../../../../common/core/2d/dimension.js';\nimport { Position } from '../../../../../../../common/core/position.js';\nimport { Range } from '../../../../../../../common/core/range.js';\nimport { LineRange } from '../../../../../../../common/core/ranges/lineRange.js';\nimport { OffsetRange } from '../../../../../../../common/core/ranges/offsetRange.js';\nimport { DetailedLineRangeMapping } from '../../../../../../../common/diff/rangeMapping.js';\nimport { IModelDeltaDecoration, ITextModel } from '../../../../../../../common/model.js';\nimport { ModelDecorationOptions } from '../../../../../../../common/model/textModel.js';\nimport { InlineCompletionContextKeys } from '../../../../controller/inlineCompletionContextKeys.js';\nimport { InlineEditsGutterIndicator, InlineEditsGutterIndicatorData, InlineSuggestionGutterMenuData, SimpleInlineSuggestModel } from '../../components/gutterIndicatorView.js';\nimport { InlineEditTabAction } from '../../inlineEditsViewInterface.js';\nimport { classNames, maxContentWidthInRange } from '../../utils/utils.js';\nimport { JumpToView } from '../jumpToView.js';\nimport { TextModelValueReference } from '../../../../model/textModelValueReference.js';\n\nexport interface ILongDistancePreviewProps {\n\tnextCursorPosition: Position | null; // assert: nextCursorPosition !== null  xor  diff.length > 0\n\tdiff: DetailedLineRangeMapping[];\n\tmodel: SimpleInlineSuggestModel;\n\tinlineSuggestInfo: InlineSuggestionGutterMenuData;\n\t/**\n\t * The URI of the file the edit targets.\n\t * When undefined (or same as the editor's model URI), the edit targets the current file.\n\t */\n\ttarget: TextModelValueReference;\n}\n\nexport class LongDistancePreviewEditor extends Disposable {\n\tpublic readonly previewEditor;\n\tprivate readonly _previewEditorObs;\n\n\tprivate readonly _previewRef = n.ref<HTMLDivElement>();\n\tpublic readonly element = n.div({ class: 'preview', style: { /*pointerEvents: 'none'*/ }, ref: this._previewRef });\n\n\tprivate _parentEditorObs: ObservableCodeEditor;\n\n\tconstructor(\n\t\tprivate readonly _previewTextModel: ITextModel,\n\t\tprivate readonly _properties: IObservable<ILongDistancePreviewProps | undefined>,\n\t\tprivate readonly _parentEditor: ICodeEditor,\n\t\tprivate readonly _tabAction: IObservable<InlineEditTabAction>,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis.previewEditor = this._register(this._createPreviewEditor());\n\t\tthis._parentEditorObs = observableCodeEditor(this._parentEditor);\n\n\t\tthis._register(autorun(reader => {\n\t\t\tconst tm = this._state.read(reader)?.textModel || null;\n\n\t\t\tif (tm) {\n\t\t\t\t// Avoid transitions from tm -> null -> tm, where tm -> tm would be a no-op.\n\t\t\t\tthis.previewEditor.setModel(tm.dangerouslyGetUnderlyingModel());\n\t\t\t}\n\t\t}));\n\n\t\tthis._previewEditorObs = observableCodeEditor(this.previewEditor);\n\t\tthis._register(this._previewEditorObs.setDecorations(derived(reader => {\n\t\t\tconst state = this._state.read(reader);\n\t\t\tconst decorations = this._editorDecorations.read(reader);\n\t\t\treturn (state?.mode === 'original' ? decorations?.originalDecorations : decorations?.modifiedDecorations) ?? [];\n\t\t})));\n\n\t\tconst showJumpToDecoration = false;\n\n\t\tif (showJumpToDecoration) {\n\t\t\tthis._register(this._instantiationService.createInstance(JumpToView, this._previewEditorObs, { style: 'cursor' }, derived(reader => {\n\t\t\t\tconst p = this._properties.read(reader);\n\t\t\t\tif (!p || !p.nextCursorPosition) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tjumpToPosition: p.nextCursorPosition,\n\n\t\t\t\t};\n\t\t\t})));\n\t\t}\n\n\t\t// Mirror the cursor position. Allows the gutter arrow to point in the correct direction.\n\t\tthis._register(autorun((reader) => {\n\t\t\tif (!this._properties.read(reader)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst cursorPosition = this._parentEditorObs.cursorPosition.read(reader);\n\t\t\tif (cursorPosition) {\n\t\t\t\tthis.previewEditor.setPosition(this._previewTextModel.validatePosition(cursorPosition), 'longDistanceHintPreview');\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(autorun(reader => {\n\t\t\tconst state = this._state.read(reader);\n\t\t\tif (!state) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Ensure there is enough space to the left of the line number for the gutter indicator to fits.\n\t\t\tconst lineNumberDigets = state.visibleLineRange.startLineNumber.toString().length;\n\t\t\tthis.previewEditor.updateOptions({ lineNumbersMinChars: lineNumberDigets + 1 });\n\t\t}));\n\n\t\tthis._register(this._instantiationService.createInstance(\n\t\t\tInlineEditsGutterIndicator,\n\t\t\tthis._previewEditorObs,\n\t\t\tderived(reader => {\n\t\t\t\tconst state = this._state.read(reader);\n\t\t\t\tif (!state) { return undefined; }\n\t\t\t\tconst props = this._properties.read(reader);\n\t\t\t\tif (!props) { return undefined; }\n\t\t\t\treturn new InlineEditsGutterIndicatorData(\n\t\t\t\t\tprops.inlineSuggestInfo,\n\t\t\t\t\tLineRange.ofLength(state.visibleLineRange.startLineNumber, 1),\n\t\t\t\t\tprops.model,\n\t\t\t\t\tundefined,\n\t\t\t\t);\n\t\t\t}),\n\t\t\tthis._tabAction,\n\t\t\tconstObservable(0),\n\t\t\tconstObservable(false),\n\t\t\tobservableValue(this, false),\n\t\t));\n\n\t\tthis.updatePreviewEditorEffect.recomputeInitiallyAndOnChange(this._store);\n\t}\n\n\tprivate readonly _state = derived<{\n\t\tmode: 'original' | 'modified';\n\t\tvisibleLineRange: LineRange;\n\t\ttextModel: TextModelValueReference | undefined;\n\t\tdiff: DetailedLineRangeMapping[];\n\t} | undefined>(this, reader => {\n\t\tconst props = this._properties.read(reader);\n\t\tif (!props) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tlet mode: 'original' | 'modified';\n\t\tlet visibleRange: LineRange;\n\n\t\tif (props.nextCursorPosition !== null) {\n\t\t\tmode = 'original';\n\t\t\tvisibleRange = LineRange.ofLength(props.nextCursorPosition.lineNumber, 1);\n\t\t} else {\n\t\t\tif (props.diff[0].innerChanges?.every(c => c.modifiedRange.isEmpty())) {\n\t\t\t\tmode = 'original';\n\t\t\t\tvisibleRange = LineRange.ofLength(props.diff[0].original.startLineNumber, 1);\n\t\t\t} else {\n\t\t\t\tmode = 'modified';\n\t\t\t\tvisibleRange = LineRange.ofLength(props.diff[0].modified.startLineNumber, 1);\n\t\t\t}\n\t\t}\n\n\t\tconst textModel = mode === 'modified'\n\t\t\t? TextModelValueReference.snapshot(this._previewTextModel)\n\t\t\t: props.target;\n\n\t\treturn {\n\t\t\tmode,\n\t\t\tvisibleLineRange: visibleRange,\n\t\t\ttextModel,\n\t\t\tdiff: props.diff,\n\t\t};\n\t});\n\n\tprivate _createPreviewEditor() {\n\t\treturn this._instantiationService.createInstance(\n\t\t\tEmbeddedCodeEditorWidget,\n\t\t\tthis._previewRef.element,\n\t\t\t{\n\t\t\t\tglyphMargin: false,\n\t\t\t\tlineNumbers: 'on',\n\t\t\t\tminimap: { enabled: false },\n\t\t\t\tguides: {\n\t\t\t\t\tindentation: false,\n\t\t\t\t\tbracketPairs: false,\n\t\t\t\t\tbracketPairsHorizontal: false,\n\t\t\t\t\thighlightActiveIndentation: false,\n\t\t\t\t},\n\t\t\t\teditContext: false, // is a bit faster\n\t\t\t\trulers: [],\n\t\t\t\tpadding: { top: 0, bottom: 0 },\n\t\t\t\t//folding: false,\n\t\t\t\tselectOnLineNumbers: false,\n\t\t\t\tselectionHighlight: false,\n\t\t\t\tcolumnSelection: false,\n\t\t\t\toverviewRulerBorder: false,\n\t\t\t\toverviewRulerLanes: 0,\n\t\t\t\t//lineDecorationsWidth: 0,\n\t\t\t\t//lineNumbersMinChars: 0,\n\t\t\t\trevealHorizontalRightPadding: 0,\n\t\t\t\tbracketPairColorization: { enabled: true, independentColorPoolPerBracketType: false },\n\t\t\t\tscrollBeyondLastLine: false,\n\t\t\t\tscrollbar: {\n\t\t\t\t\tvertical: 'hidden',\n\t\t\t\t\thorizontal: 'hidden',\n\t\t\t\t\thandleMouseWheel: false,\n\t\t\t\t},\n\t\t\t\treadOnly: true,\n\t\t\t\twordWrap: 'off',\n\t\t\t\twordWrapOverride1: 'off',\n\t\t\t\twordWrapOverride2: 'off',\n\t\t\t},\n\t\t\t{\n\t\t\t\tcontextKeyValues: {\n\t\t\t\t\t[InlineCompletionContextKeys.inInlineEditsPreviewEditor.key]: true,\n\t\t\t\t},\n\t\t\t\tcontributions: [],\n\t\t\t},\n\t\t\tthis._parentEditor\n\t\t);\n\t}\n\n\tpublic readonly updatePreviewEditorEffect = derived(this, reader => {\n\t\t// this._widgetContent.readEffect(reader);\n\t\tthis._previewEditorObs.model.read(reader); // update when the model is set\n\n\t\tconst range = this._state.read(reader)?.visibleLineRange;\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\t\tconst hiddenAreas: Range[] = [];\n\t\tif (range.startLineNumber > 1) {\n\t\t\thiddenAreas.push(new Range(1, 1, range.startLineNumber - 1, 1));\n\t\t}\n\t\tif (range.endLineNumberExclusive < this._previewTextModel.getLineCount() + 1) {\n\t\t\thiddenAreas.push(new Range(range.endLineNumberExclusive, 1, this._previewTextModel.getLineCount() + 1, 1));\n\t\t}\n\t\tthis.previewEditor.setHiddenAreas(hiddenAreas, undefined, true);\n\t});\n\n\tpublic readonly horizontalContentRangeInPreviewEditorToShow = derived(this, reader => {\n\t\treturn this._getHorizontalContentRangeInPreviewEditorToShow(this.previewEditor, reader);\n\t});\n\n\tpublic readonly contentHeight = derived(this, (reader) => {\n\t\tconst viewState = this._state.read(reader);\n\t\tif (!viewState) {\n\t\t\treturn constObservable(null);\n\t\t}\n\n\t\tconst previewEditorHeight = this._previewEditorObs.observeLineHeightForLine(viewState.visibleLineRange.startLineNumber);\n\t\treturn previewEditorHeight;\n\t}).flatten();\n\n\tprivate _getHorizontalContentRangeInPreviewEditorToShow(editor: ICodeEditor, reader: IReader) {\n\t\tconst state = this._state.read(reader);\n\t\tif (!state) { return undefined; }\n\n\t\tconst diff = state.diff;\n\t\tconst jumpToPos = this._properties.read(reader)?.nextCursorPosition;\n\n\t\tconst visibleRange = state.visibleLineRange;\n\t\tconst l = this._previewEditorObs.layoutInfo.read(reader);\n\t\tconst trueContentWidth = maxContentWidthInRange(this._previewEditorObs, visibleRange, reader);\n\n\t\tlet firstCharacterChange: Range;\n\t\tif (jumpToPos) {\n\t\t\tfirstCharacterChange = Range.fromPositions(jumpToPos);\n\t\t} else if (diff[0].innerChanges) {\n\t\t\tfirstCharacterChange = state.mode === 'modified' ? diff[0].innerChanges[0].modifiedRange : diff[0].innerChanges[0].originalRange;\n\t\t} else {\n\t\t\treturn undefined;\n\t\t}\n\n\n\t\t// find the horizontal range we want to show.\n\t\tconst preferredRange = growUntilVariableBoundaries(editor.getModel()!, firstCharacterChange, 5);\n\t\tconst leftOffset = this._previewEditorObs.getLeftOfPosition(preferredRange.getStartPosition(), reader);\n\t\tconst rightOffset = this._previewEditorObs.getLeftOfPosition(preferredRange.getEndPosition(), reader);\n\n\t\tconst left = clamp(leftOffset, 0, trueContentWidth);\n\t\tconst right = clamp(rightOffset, left, trueContentWidth);\n\n\t\tconst indentCol = editor.getModel()!.getLineFirstNonWhitespaceColumn(preferredRange.startLineNumber);\n\t\tconst indentationEnd = this._previewEditorObs.getLeftOfPosition(new Position(preferredRange.startLineNumber, indentCol), reader);\n\n\t\tconst preferredRangeToReveal = new OffsetRange(left, right);\n\n\t\treturn {\n\t\t\tindentationEnd,\n\t\t\tpreferredRangeToReveal,\n\t\t\tmaxEditorWidth: trueContentWidth + l.contentLeft,\n\t\t\tcontentWidth: trueContentWidth,\n\t\t\tnonContentWidth: l.contentLeft, // Width of area that is not content\n\t\t};\n\t}\n\n\tpublic layout(dimension: IDimension, desiredPreviewEditorScrollLeft: number): void {\n\t\tthis.previewEditor.layout(dimension);\n\t\tthis._previewEditorObs.editor.setScrollLeft(desiredPreviewEditorScrollLeft);\n\t}\n\n\tprivate readonly _editorDecorations = derived(this, reader => {\n\t\tconst state = this._state.read(reader);\n\t\tif (!state) { return undefined; }\n\n\t\tconst diff = {\n\t\t\tmode: 'insertionInline' as const,\n\t\t\tdiff: state.diff,\n\t\t};\n\t\tconst originalDecorations: IModelDeltaDecoration[] = [];\n\t\tconst modifiedDecorations: IModelDeltaDecoration[] = [];\n\n\t\tconst diffWholeLineDeleteDecoration = ModelDecorationOptions.register({\n\t\t\tclassName: 'inlineCompletions-char-delete',\n\t\t\tdescription: 'char-delete',\n\t\t\tisWholeLine: false,\n\t\t\tzIndex: 1, // be on top of diff background decoration\n\t\t});\n\n\t\tconst diffWholeLineAddDecoration = ModelDecorationOptions.register({\n\t\t\tclassName: 'inlineCompletions-char-insert',\n\t\t\tdescription: 'char-insert',\n\t\t\tisWholeLine: true,\n\t\t});\n\n\t\tconst diffAddDecoration = ModelDecorationOptions.register({\n\t\t\tclassName: 'inlineCompletions-char-insert',\n\t\t\tdescription: 'char-insert',\n\t\t\tshouldFillLineOnLineBreak: true,\n\t\t});\n\n\t\tconst hideEmptyInnerDecorations = true; // diff.mode === 'lineReplacement';\n\t\tfor (const m of diff.diff) {\n\t\t\tif (m.modified.isEmpty || m.original.isEmpty) {\n\t\t\t\tif (!m.original.isEmpty) {\n\t\t\t\t\toriginalDecorations.push({ range: m.original.toInclusiveRange()!, options: diffWholeLineDeleteDecoration });\n\t\t\t\t}\n\t\t\t\tif (!m.modified.isEmpty) {\n\t\t\t\t\tmodifiedDecorations.push({ range: m.modified.toInclusiveRange()!, options: diffWholeLineAddDecoration });\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (const i of m.innerChanges || []) {\n\t\t\t\t\t// Don't show empty markers outside the line range\n\t\t\t\t\tif (m.original.contains(i.originalRange.startLineNumber) && !(hideEmptyInnerDecorations && i.originalRange.isEmpty())) {\n\t\t\t\t\t\toriginalDecorations.push({\n\t\t\t\t\t\t\trange: i.originalRange,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tdescription: 'char-delete',\n\t\t\t\t\t\t\t\tshouldFillLineOnLineBreak: false,\n\t\t\t\t\t\t\t\tclassName: classNames(\n\t\t\t\t\t\t\t\t\t'inlineCompletions-char-delete',\n\t\t\t\t\t\t\t\t\t// i.originalRange.isSingleLine() && diff.mode === 'insertionInline' && 'single-line-inline',\n\t\t\t\t\t\t\t\t\ti.originalRange.isEmpty() && 'empty',\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\tzIndex: 1\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (m.modified.contains(i.modifiedRange.startLineNumber)) {\n\t\t\t\t\t\tmodifiedDecorations.push({\n\t\t\t\t\t\t\trange: i.modifiedRange,\n\t\t\t\t\t\t\toptions: diffAddDecoration\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn { originalDecorations, modifiedDecorations };\n\t});\n}\n\n/*\n * Grows the range on each ends until it includes a none-variable-name character\n * or the next character would be a whitespace character\n * or the maxGrow limit is reached\n */\nfunction growUntilVariableBoundaries(textModel: ITextModel, range: Range, maxGrow: number): Range {\n\tconst startPosition = range.getStartPosition();\n\tconst endPosition = range.getEndPosition();\n\tconst line = textModel.getLineContent(startPosition.lineNumber);\n\n\tfunction isVariableNameCharacter(col: number): boolean {\n\t\tconst char = line.charAt(col - 1);\n\t\treturn (/[a-zA-Z0-9_]/).test(char);\n\t}\n\n\tfunction isWhitespace(col: number): boolean {\n\t\tconst char = line.charAt(col - 1);\n\t\treturn char === ' ' || char === '\\t';\n\t}\n\n\tlet startColumn = startPosition.column;\n\twhile (startColumn > 1 && isVariableNameCharacter(startColumn) && !isWhitespace(startColumn - 1) && startPosition.column - startColumn < maxGrow) {\n\t\tstartColumn--;\n\t}\n\n\tlet endColumn = endPosition.column - 1;\n\twhile (endColumn <= line.length && isVariableNameCharacter(endColumn) && !isWhitespace(endColumn + 1) && endColumn - endPosition.column < maxGrow) {\n\t\tendColumn++;\n\t}\n\n\treturn new Range(startPosition.lineNumber, startPosition.column, endPosition.lineNumber, endColumn + 1);\n}\n"]}