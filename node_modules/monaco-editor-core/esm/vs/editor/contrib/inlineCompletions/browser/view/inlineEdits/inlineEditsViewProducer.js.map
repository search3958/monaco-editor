{"version":3,"sources":["file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src/vs/editor/contrib/inlineCompletions/browser/view/inlineEdits/inlineEditsViewProducer.ts","vs/editor/contrib/inlineCompletions/browser/view/inlineEdits/inlineEditsViewProducer.ts"],"names":[],"mappings":"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","file":"inlineEditsViewProducer.js","sourceRoot":"file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../../../../base/common/lifecycle.js';\nimport { derived, IObservable } from '../../../../../../base/common/observable.js';\nimport { IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { ICodeEditor } from '../../../../../browser/editorBrowser.js';\nimport { ObservableCodeEditor, observableCodeEditor } from '../../../../../browser/observableCodeEditor.js';\nimport { Range } from '../../../../../common/core/range.js';\nimport { TextReplacement, TextEdit } from '../../../../../common/core/edits/textEdit.js';\nimport { InlineCompletionsModel } from '../../model/inlineCompletionsModel.js';\nimport { InlineEditWithChanges } from './inlineEditWithChanges.js';\nimport { ModelPerInlineEdit } from './inlineEditsModel.js';\nimport { InlineEditsView } from './inlineEditsView.js';\nimport { InlineEditTabAction } from './inlineEditsViewInterface.js';\nimport { InlineSuggestionGutterMenuData, SimpleInlineSuggestModel } from './components/gutterIndicatorView.js';\n\nexport class InlineEditsViewAndDiffProducer extends Disposable { // TODO: This class is no longer a diff producer. Rename it or get rid of it\n\tprivate readonly _editorObs: ObservableCodeEditor;\n\n\tprivate readonly _inlineEdit = derived<InlineEditWithChanges | undefined>(this, (reader) => {\n\t\tconst model = this._model.read(reader);\n\t\tif (!model) { return undefined; }\n\t\tconst textModel = this._editor.getModel();\n\t\tif (!textModel) { return undefined; }\n\n\t\tconst state = model.inlineEditState.read(reader);\n\t\tif (!state) { return undefined; }\n\t\tconst action = state.inlineSuggestion.action;\n\n\t\tlet diffEdits: TextEdit | undefined;\n\n\t\tif (action?.kind === 'edit') {\n\t\t\tconst editOffset = action.stringEdit;\n\t\t\tconst t = state.inlineSuggestion.originalTextRef.getTransformer();\n\t\t\tconst edits = editOffset.replacements.map(e => {\n\t\t\t\tconst innerEditRange = Range.fromPositions(\n\t\t\t\t\tt.getPosition(e.replaceRange.start),\n\t\t\t\t\tt.getPosition(e.replaceRange.endExclusive)\n\t\t\t\t);\n\t\t\t\treturn new TextReplacement(innerEditRange, e.newText);\n\t\t\t});\n\t\t\tdiffEdits = new TextEdit(edits);\n\t\t} else {\n\t\t\tdiffEdits = undefined;\n\t\t}\n\n\t\treturn new InlineEditWithChanges(\n\t\t\tstate.inlineSuggestion.originalTextRef,\n\t\t\taction,\n\t\t\tdiffEdits,\n\t\t\tmodel.primaryPosition.read(undefined),\n\t\t\tmodel.allPositions.read(undefined),\n\t\t\tstate.inlineSuggestion.source.inlineSuggestions.commands ?? [],\n\t\t\tstate.inlineSuggestion\n\t\t);\n\t});\n\n\tpublic readonly _inlineEditModel = derived<ModelPerInlineEdit | undefined>(this, reader => {\n\t\tconst model = this._model.read(reader);\n\t\tif (!model) { return undefined; }\n\t\tconst edit = this._inlineEdit.read(reader);\n\t\tif (!edit) { return undefined; }\n\n\t\tconst tabAction = derived<InlineEditTabAction>(this, reader => {\n\t\t\t/** @description tabAction */\n\t\t\tif (this._editorObs.isFocused.read(reader)) {\n\t\t\t\tif (model.tabShouldJumpToInlineEdit.read(reader)) { return InlineEditTabAction.Jump; }\n\t\t\t\tif (model.tabShouldAcceptInlineEdit.read(reader)) { return InlineEditTabAction.Accept; }\n\t\t\t}\n\t\t\treturn InlineEditTabAction.Inactive;\n\t\t});\n\n\t\treturn new ModelPerInlineEdit(model, edit, tabAction);\n\t});\n\n\tpublic readonly view: InlineEditsView;\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\tprivate readonly _model: IObservable<InlineCompletionsModel | undefined>,\n\t\tprivate readonly _showCollapsed: IObservable<boolean>,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis._editorObs = observableCodeEditor(this._editor);\n\n\t\tthis.view = this._register(instantiationService.createInstance(InlineEditsView, this._editor, this._inlineEditModel,\n\t\t\tthis._model.map(model => model ? SimpleInlineSuggestModel.fromInlineCompletionModel(model) : undefined),\n\t\t\tthis._inlineEdit.map(e => e ? InlineSuggestionGutterMenuData.fromInlineSuggestion(e.inlineCompletion) : undefined),\n\t\t\tthis._showCollapsed,\n\t\t));\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../../../../base/common/lifecycle.js';\nimport { derived, IObservable } from '../../../../../../base/common/observable.js';\nimport { IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { ICodeEditor } from '../../../../../browser/editorBrowser.js';\nimport { ObservableCodeEditor, observableCodeEditor } from '../../../../../browser/observableCodeEditor.js';\nimport { Range } from '../../../../../common/core/range.js';\nimport { TextReplacement, TextEdit } from '../../../../../common/core/edits/textEdit.js';\nimport { InlineCompletionsModel } from '../../model/inlineCompletionsModel.js';\nimport { InlineEditWithChanges } from './inlineEditWithChanges.js';\nimport { ModelPerInlineEdit } from './inlineEditsModel.js';\nimport { InlineEditsView } from './inlineEditsView.js';\nimport { InlineEditTabAction } from './inlineEditsViewInterface.js';\nimport { InlineSuggestionGutterMenuData, SimpleInlineSuggestModel } from './components/gutterIndicatorView.js';\n\nexport class InlineEditsViewAndDiffProducer extends Disposable { // TODO: This class is no longer a diff producer. Rename it or get rid of it\n\tprivate readonly _editorObs: ObservableCodeEditor;\n\n\tprivate readonly _inlineEdit = derived<InlineEditWithChanges | undefined>(this, (reader) => {\n\t\tconst model = this._model.read(reader);\n\t\tif (!model) { return undefined; }\n\t\tconst textModel = this._editor.getModel();\n\t\tif (!textModel) { return undefined; }\n\n\t\tconst state = model.inlineEditState.read(reader);\n\t\tif (!state) { return undefined; }\n\t\tconst action = state.inlineSuggestion.action;\n\n\t\tlet diffEdits: TextEdit | undefined;\n\n\t\tif (action?.kind === 'edit') {\n\t\t\tconst editOffset = action.stringEdit;\n\t\t\tconst t = state.inlineSuggestion.originalTextRef.getTransformer();\n\t\t\tconst edits = editOffset.replacements.map(e => {\n\t\t\t\tconst innerEditRange = Range.fromPositions(\n\t\t\t\t\tt.getPosition(e.replaceRange.start),\n\t\t\t\t\tt.getPosition(e.replaceRange.endExclusive)\n\t\t\t\t);\n\t\t\t\treturn new TextReplacement(innerEditRange, e.newText);\n\t\t\t});\n\t\t\tdiffEdits = new TextEdit(edits);\n\t\t} else {\n\t\t\tdiffEdits = undefined;\n\t\t}\n\n\t\treturn new InlineEditWithChanges(\n\t\t\tstate.inlineSuggestion.originalTextRef,\n\t\t\taction,\n\t\t\tdiffEdits,\n\t\t\tmodel.primaryPosition.read(undefined),\n\t\t\tmodel.allPositions.read(undefined),\n\t\t\tstate.inlineSuggestion.source.inlineSuggestions.commands ?? [],\n\t\t\tstate.inlineSuggestion\n\t\t);\n\t});\n\n\tpublic readonly _inlineEditModel = derived<ModelPerInlineEdit | undefined>(this, reader => {\n\t\tconst model = this._model.read(reader);\n\t\tif (!model) { return undefined; }\n\t\tconst edit = this._inlineEdit.read(reader);\n\t\tif (!edit) { return undefined; }\n\n\t\tconst tabAction = derived<InlineEditTabAction>(this, reader => {\n\t\t\t/** @description tabAction */\n\t\t\tif (this._editorObs.isFocused.read(reader)) {\n\t\t\t\tif (model.tabShouldJumpToInlineEdit.read(reader)) { return InlineEditTabAction.Jump; }\n\t\t\t\tif (model.tabShouldAcceptInlineEdit.read(reader)) { return InlineEditTabAction.Accept; }\n\t\t\t}\n\t\t\treturn InlineEditTabAction.Inactive;\n\t\t});\n\n\t\treturn new ModelPerInlineEdit(model, edit, tabAction);\n\t});\n\n\tpublic readonly view: InlineEditsView;\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\tprivate readonly _model: IObservable<InlineCompletionsModel | undefined>,\n\t\tprivate readonly _showCollapsed: IObservable<boolean>,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis._editorObs = observableCodeEditor(this._editor);\n\n\t\tthis.view = this._register(instantiationService.createInstance(InlineEditsView, this._editor, this._inlineEditModel,\n\t\t\tthis._model.map(model => model ? SimpleInlineSuggestModel.fromInlineCompletionModel(model) : undefined),\n\t\t\tthis._inlineEdit.map(e => e ? InlineSuggestionGutterMenuData.fromInlineSuggestion(e.inlineCompletion) : undefined),\n\t\t\tthis._showCollapsed,\n\t\t));\n\t}\n}\n"]}