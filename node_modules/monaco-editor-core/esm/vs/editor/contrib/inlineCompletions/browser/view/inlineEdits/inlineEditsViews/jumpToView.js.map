{"version":3,"sources":["file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src/vs/editor/contrib/inlineCompletions/browser/view/inlineEdits/inlineEditsViews/jumpToView.ts","vs/editor/contrib/inlineCompletions/browser/view/inlineEdits/inlineEditsViews/jumpToView.ts"],"names":[],"mappings":"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","file":"jumpToView.js","sourceRoot":"file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { n } from '../../../../../../../base/browser/dom.js';\nimport { KeybindingLabel } from '../../../../../../../base/browser/ui/keybindingLabel/keybindingLabel.js';\nimport { RunOnceScheduler } from '../../../../../../../base/common/async.js';\nimport { ResolvedKeybinding } from '../../../../../../../base/common/keybindings.js';\nimport { Disposable } from '../../../../../../../base/common/lifecycle.js';\nimport { autorun, constObservable, DebugLocation, derived, IObservable, observableFromEvent } from '../../../../../../../base/common/observable.js';\nimport { OS } from '../../../../../../../base/common/platform.js';\nimport { IContextKeyService } from '../../../../../../../platform/contextkey/common/contextkey.js';\nimport { IKeybindingService } from '../../../../../../../platform/keybinding/common/keybinding.js';\nimport { defaultKeybindingLabelStyles } from '../../../../../../../platform/theme/browser/defaultStyles.js';\nimport { asCssVariable } from '../../../../../../../platform/theme/common/colorUtils.js';\nimport { IThemeService } from '../../../../../../../platform/theme/common/themeService.js';\nimport { ObservableCodeEditor } from '../../../../../../browser/observableCodeEditor.js';\nimport { Rect } from '../../../../../../common/core/2d/rect.js';\nimport { Position } from '../../../../../../common/core/position.js';\nimport { Range } from '../../../../../../common/core/range.js';\nimport { IModelDeltaDecoration } from '../../../../../../common/model.js';\nimport { inlineSuggestCommitId } from '../../../controller/commandIds.js';\nimport { getEditorBlendedColor, inlineEditIndicatorPrimaryBackground, inlineEditIndicatorPrimaryBorder, inlineEditIndicatorPrimaryForeground } from '../theme.js';\nimport { rectToProps } from '../utils/utils.js';\n\nexport class JumpToView extends Disposable {\n\tprivate readonly _style: 'label' | 'cursor';\n\n\tconstructor(\n\t\tprivate readonly _editor: ObservableCodeEditor,\n\t\toptions: { style: 'label' | 'cursor' },\n\t\tprivate readonly _data: IObservable<{ jumpToPosition: Position } | undefined>,\n\t\t@IThemeService private readonly _themeService: IThemeService,\n\t\t@IKeybindingService private readonly _keybindingService: IKeybindingService,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService\n\t) {\n\t\tsuper();\n\n\t\tthis._style = options.style;\n\t\tthis._keybinding = this._getKeybinding(inlineSuggestCommitId);\n\n\t\tconst widget = this._widget.keepUpdated(this._store);\n\n\t\tthis._register(this._editor.createOverlayWidget({\n\t\t\tdomNode: widget.element,\n\t\t\tposition: constObservable(null),\n\t\t\tallowEditorOverflow: false,\n\t\t\tminContentWidthInPx: constObservable(0),\n\t\t}));\n\n\t\tthis._register(this._editor.setDecorations(derived<IModelDeltaDecoration[]>(reader => {\n\t\t\tconst data = this._data.read(reader);\n\t\t\tif (!data) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\t// use injected text at position\n\t\t\treturn [{\n\t\t\t\trange: Range.fromPositions(data.jumpToPosition, data.jumpToPosition),\n\t\t\t\toptions: {\n\t\t\t\t\tdescription: 'inline-edit-jump-to-decoration',\n\t\t\t\t\tinlineClassNameAffectsLetterSpacing: true,\n\t\t\t\t\tshowIfCollapsed: true,\n\t\t\t\t\tafter: {\n\t\t\t\t\t\tcontent: this._style === 'label' ? '          ' : '  ',\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t} satisfies IModelDeltaDecoration];\n\t\t})));\n\t}\n\n\tprivate readonly _styles = derived(this, reader => ({\n\t\tbackground: getEditorBlendedColor(inlineEditIndicatorPrimaryBackground, this._themeService).read(reader).toString(),\n\t\tforeground: getEditorBlendedColor(inlineEditIndicatorPrimaryForeground, this._themeService).read(reader).toString(),\n\t\tborder: getEditorBlendedColor(inlineEditIndicatorPrimaryBorder, this._themeService).read(reader).toString(),\n\t}));\n\n\tprivate readonly _pos = derived(this, reader => {\n\t\treturn this._editor.observePosition(derived(reader =>\n\t\t\tthis._data.read(reader)?.jumpToPosition || null\n\t\t), reader.store);\n\t}).flatten();\n\n\tprivate _getKeybinding(commandId: string | undefined, debugLocation = DebugLocation.ofCaller()) {\n\t\tif (!commandId) {\n\t\t\treturn constObservable(undefined);\n\t\t}\n\t\treturn observableFromEvent(this, this._contextKeyService.onDidChangeContext, () => this._keybindingService.lookupKeybinding(commandId), debugLocation);\n\t\t// TODO: use contextkeyservice to use different renderings\n\t}\n\n\tprivate readonly _keybinding;\n\n\tprivate readonly _layout = derived(this, reader => {\n\t\tconst data = this._data.read(reader);\n\t\tif (!data) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst position = data.jumpToPosition;\n\t\tconst lineHeight = this._editor.observeLineHeightForLine(constObservable(position.lineNumber)).read(reader);\n\t\tconst scrollLeft = this._editor.scrollLeft.read(reader);\n\n\t\tconst point = this._pos.read(reader);\n\n\t\tif (!point) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst layout = this._editor.layoutInfo.read(reader);\n\n\t\tconst widgetRect = Rect.fromLeftTopWidthHeight(\n\t\t\tpoint.x + layout.contentLeft + 2 - scrollLeft,\n\t\t\tpoint.y,\n\t\t\t100,\n\t\t\tlineHeight\n\t\t);\n\n\t\treturn {\n\t\t\twidgetRect,\n\t\t};\n\t});\n\n\tprivate readonly _blink = animateFixedValues<boolean>([\n\t\t{ value: true, durationMs: 600 },\n\t\t{ value: false, durationMs: 600 },\n\t]);\n\n\tprivate readonly _widget = n.div({\n\t\tclass: 'inline-edit-jump-to-widget',\n\t\tstyle: {\n\t\t\tposition: 'absolute',\n\t\t\tdisplay: this._layout.map(l => l ? 'flex' : 'none'),\n\n\t\t\talignItems: 'center',\n\t\t\tcursor: 'pointer',\n\t\t\tuserSelect: 'none',\n\t\t\t...rectToProps(reader => this._layout.read(reader)?.widgetRect),\n\t\t}\n\t},\n\t\tderived(reader => {\n\t\t\tif (this._data.read(reader) === undefined) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\t// Main content container with rounded border\n\t\t\treturn n.div({\n\t\t\t\tstyle: {\n\t\t\t\t\tdisplay: 'flex',\n\t\t\t\t\talignItems: 'center',\n\t\t\t\t\tgap: '4px',\n\t\t\t\t\tpadding: '0 4px',\n\t\t\t\t\theight: '100%',\n\t\t\t\t\tbackgroundColor: this._styles.map(s => s.background),\n\t\t\t\t\t['--vscodeIconForeground' as string]: this._styles.map(s => s.foreground),\n\t\t\t\t\tborder: this._styles.map(s => `1px solid ${s.border}`),\n\t\t\t\t\tborderRadius: '3px',\n\t\t\t\t\tboxSizing: 'border-box',\n\t\t\t\t\tfontSize: '11px',\n\t\t\t\t\tcolor: this._styles.map(s => s.foreground),\n\t\t\t\t}\n\t\t\t}, [\n\t\t\t\tthis._style === 'cursor' ?\n\t\t\t\t\tn.elem('div', {\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tborderLeft: '2px solid',\n\t\t\t\t\t\t\theight: 14,\n\t\t\t\t\t\t\topacity: this._blink.map(b => b ? '0' : '1'),\n\t\t\t\t\t\t}\n\t\t\t\t\t}) :\n\n\t\t\t\t\t[\n\t\t\t\t\t\tderived(() => n.elem('div', {}, keybindingLabel(this._keybinding))),\n\t\t\t\t\t\tn.elem('div', { style: { lineHeight: this._layout.map(l => l?.widgetRect.height), marginTop: '-2px' } },\n\t\t\t\t\t\t\t['to jump',]\n\t\t\t\t\t\t)\n\t\t\t\t\t],\n\t\t\t]);\n\n\t\t})\n\t);\n}\n\nfunction animateFixedValues<T>(values: { value: T; durationMs: number }[], debugLocation = DebugLocation.ofCaller()): IObservable<T> {\n\tlet idx = 0;\n\treturn observableFromEvent(undefined, (l) => {\n\t\tidx = 0;\n\t\tconst timer = new RunOnceScheduler(() => {\n\t\t\tidx = (idx + 1) % values.length;\n\t\t\tl(null);\n\t\t\ttimer.schedule(values[idx].durationMs);\n\t\t}, 0);\n\t\ttimer.schedule(0);\n\n\t\treturn timer;\n\t}, () => {\n\t\treturn values[idx].value;\n\t}, debugLocation);\n}\n\nfunction keybindingLabel(keybinding: IObservable<ResolvedKeybinding | undefined>) {\n\treturn derived(_reader => n.div({\n\t\tstyle: {},\n\t\tref: elem => {\n\t\t\tconst keybindingLabel = _reader.store.add(new KeybindingLabel(elem, OS, {\n\t\t\t\tdisableTitle: true,\n\t\t\t\t...defaultKeybindingLabelStyles,\n\t\t\t\tkeybindingLabelShadow: undefined,\n\t\t\t\tkeybindingLabelForeground: asCssVariable(inlineEditIndicatorPrimaryForeground),\n\t\t\t\tkeybindingLabelBackground: 'transparent',\n\t\t\t\tkeybindingLabelBorder: asCssVariable(inlineEditIndicatorPrimaryForeground),\n\t\t\t\tkeybindingLabelBottomBorder: undefined,\n\t\t\t}));\n\t\t\t_reader.store.add(autorun(reader => {\n\t\t\t\tkeybindingLabel.set(keybinding.read(reader));\n\t\t\t}));\n\t\t}\n\t}));\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { n } from '../../../../../../../base/browser/dom.js';\nimport { KeybindingLabel } from '../../../../../../../base/browser/ui/keybindingLabel/keybindingLabel.js';\nimport { RunOnceScheduler } from '../../../../../../../base/common/async.js';\nimport { ResolvedKeybinding } from '../../../../../../../base/common/keybindings.js';\nimport { Disposable } from '../../../../../../../base/common/lifecycle.js';\nimport { autorun, constObservable, DebugLocation, derived, IObservable, observableFromEvent } from '../../../../../../../base/common/observable.js';\nimport { OS } from '../../../../../../../base/common/platform.js';\nimport { IContextKeyService } from '../../../../../../../platform/contextkey/common/contextkey.js';\nimport { IKeybindingService } from '../../../../../../../platform/keybinding/common/keybinding.js';\nimport { defaultKeybindingLabelStyles } from '../../../../../../../platform/theme/browser/defaultStyles.js';\nimport { asCssVariable } from '../../../../../../../platform/theme/common/colorUtils.js';\nimport { IThemeService } from '../../../../../../../platform/theme/common/themeService.js';\nimport { ObservableCodeEditor } from '../../../../../../browser/observableCodeEditor.js';\nimport { Rect } from '../../../../../../common/core/2d/rect.js';\nimport { Position } from '../../../../../../common/core/position.js';\nimport { Range } from '../../../../../../common/core/range.js';\nimport { IModelDeltaDecoration } from '../../../../../../common/model.js';\nimport { inlineSuggestCommitId } from '../../../controller/commandIds.js';\nimport { getEditorBlendedColor, inlineEditIndicatorPrimaryBackground, inlineEditIndicatorPrimaryBorder, inlineEditIndicatorPrimaryForeground } from '../theme.js';\nimport { rectToProps } from '../utils/utils.js';\n\nexport class JumpToView extends Disposable {\n\tprivate readonly _style: 'label' | 'cursor';\n\n\tconstructor(\n\t\tprivate readonly _editor: ObservableCodeEditor,\n\t\toptions: { style: 'label' | 'cursor' },\n\t\tprivate readonly _data: IObservable<{ jumpToPosition: Position } | undefined>,\n\t\t@IThemeService private readonly _themeService: IThemeService,\n\t\t@IKeybindingService private readonly _keybindingService: IKeybindingService,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService\n\t) {\n\t\tsuper();\n\n\t\tthis._style = options.style;\n\t\tthis._keybinding = this._getKeybinding(inlineSuggestCommitId);\n\n\t\tconst widget = this._widget.keepUpdated(this._store);\n\n\t\tthis._register(this._editor.createOverlayWidget({\n\t\t\tdomNode: widget.element,\n\t\t\tposition: constObservable(null),\n\t\t\tallowEditorOverflow: false,\n\t\t\tminContentWidthInPx: constObservable(0),\n\t\t}));\n\n\t\tthis._register(this._editor.setDecorations(derived<IModelDeltaDecoration[]>(reader => {\n\t\t\tconst data = this._data.read(reader);\n\t\t\tif (!data) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\t// use injected text at position\n\t\t\treturn [{\n\t\t\t\trange: Range.fromPositions(data.jumpToPosition, data.jumpToPosition),\n\t\t\t\toptions: {\n\t\t\t\t\tdescription: 'inline-edit-jump-to-decoration',\n\t\t\t\t\tinlineClassNameAffectsLetterSpacing: true,\n\t\t\t\t\tshowIfCollapsed: true,\n\t\t\t\t\tafter: {\n\t\t\t\t\t\tcontent: this._style === 'label' ? '          ' : '  ',\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t} satisfies IModelDeltaDecoration];\n\t\t})));\n\t}\n\n\tprivate readonly _styles = derived(this, reader => ({\n\t\tbackground: getEditorBlendedColor(inlineEditIndicatorPrimaryBackground, this._themeService).read(reader).toString(),\n\t\tforeground: getEditorBlendedColor(inlineEditIndicatorPrimaryForeground, this._themeService).read(reader).toString(),\n\t\tborder: getEditorBlendedColor(inlineEditIndicatorPrimaryBorder, this._themeService).read(reader).toString(),\n\t}));\n\n\tprivate readonly _pos = derived(this, reader => {\n\t\treturn this._editor.observePosition(derived(reader =>\n\t\t\tthis._data.read(reader)?.jumpToPosition || null\n\t\t), reader.store);\n\t}).flatten();\n\n\tprivate _getKeybinding(commandId: string | undefined, debugLocation = DebugLocation.ofCaller()) {\n\t\tif (!commandId) {\n\t\t\treturn constObservable(undefined);\n\t\t}\n\t\treturn observableFromEvent(this, this._contextKeyService.onDidChangeContext, () => this._keybindingService.lookupKeybinding(commandId), debugLocation);\n\t\t// TODO: use contextkeyservice to use different renderings\n\t}\n\n\tprivate readonly _keybinding;\n\n\tprivate readonly _layout = derived(this, reader => {\n\t\tconst data = this._data.read(reader);\n\t\tif (!data) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst position = data.jumpToPosition;\n\t\tconst lineHeight = this._editor.observeLineHeightForLine(constObservable(position.lineNumber)).read(reader);\n\t\tconst scrollLeft = this._editor.scrollLeft.read(reader);\n\n\t\tconst point = this._pos.read(reader);\n\n\t\tif (!point) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst layout = this._editor.layoutInfo.read(reader);\n\n\t\tconst widgetRect = Rect.fromLeftTopWidthHeight(\n\t\t\tpoint.x + layout.contentLeft + 2 - scrollLeft,\n\t\t\tpoint.y,\n\t\t\t100,\n\t\t\tlineHeight\n\t\t);\n\n\t\treturn {\n\t\t\twidgetRect,\n\t\t};\n\t});\n\n\tprivate readonly _blink = animateFixedValues<boolean>([\n\t\t{ value: true, durationMs: 600 },\n\t\t{ value: false, durationMs: 600 },\n\t]);\n\n\tprivate readonly _widget = n.div({\n\t\tclass: 'inline-edit-jump-to-widget',\n\t\tstyle: {\n\t\t\tposition: 'absolute',\n\t\t\tdisplay: this._layout.map(l => l ? 'flex' : 'none'),\n\n\t\t\talignItems: 'center',\n\t\t\tcursor: 'pointer',\n\t\t\tuserSelect: 'none',\n\t\t\t...rectToProps(reader => this._layout.read(reader)?.widgetRect),\n\t\t}\n\t},\n\t\tderived(reader => {\n\t\t\tif (this._data.read(reader) === undefined) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\t// Main content container with rounded border\n\t\t\treturn n.div({\n\t\t\t\tstyle: {\n\t\t\t\t\tdisplay: 'flex',\n\t\t\t\t\talignItems: 'center',\n\t\t\t\t\tgap: '4px',\n\t\t\t\t\tpadding: '0 4px',\n\t\t\t\t\theight: '100%',\n\t\t\t\t\tbackgroundColor: this._styles.map(s => s.background),\n\t\t\t\t\t['--vscodeIconForeground' as string]: this._styles.map(s => s.foreground),\n\t\t\t\t\tborder: this._styles.map(s => `1px solid ${s.border}`),\n\t\t\t\t\tborderRadius: '3px',\n\t\t\t\t\tboxSizing: 'border-box',\n\t\t\t\t\tfontSize: '11px',\n\t\t\t\t\tcolor: this._styles.map(s => s.foreground),\n\t\t\t\t}\n\t\t\t}, [\n\t\t\t\tthis._style === 'cursor' ?\n\t\t\t\t\tn.elem('div', {\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tborderLeft: '2px solid',\n\t\t\t\t\t\t\theight: 14,\n\t\t\t\t\t\t\topacity: this._blink.map(b => b ? '0' : '1'),\n\t\t\t\t\t\t}\n\t\t\t\t\t}) :\n\n\t\t\t\t\t[\n\t\t\t\t\t\tderived(() => n.elem('div', {}, keybindingLabel(this._keybinding))),\n\t\t\t\t\t\tn.elem('div', { style: { lineHeight: this._layout.map(l => l?.widgetRect.height), marginTop: '-2px' } },\n\t\t\t\t\t\t\t['to jump',]\n\t\t\t\t\t\t)\n\t\t\t\t\t],\n\t\t\t]);\n\n\t\t})\n\t);\n}\n\nfunction animateFixedValues<T>(values: { value: T; durationMs: number }[], debugLocation = DebugLocation.ofCaller()): IObservable<T> {\n\tlet idx = 0;\n\treturn observableFromEvent(undefined, (l) => {\n\t\tidx = 0;\n\t\tconst timer = new RunOnceScheduler(() => {\n\t\t\tidx = (idx + 1) % values.length;\n\t\t\tl(null);\n\t\t\ttimer.schedule(values[idx].durationMs);\n\t\t}, 0);\n\t\ttimer.schedule(0);\n\n\t\treturn timer;\n\t}, () => {\n\t\treturn values[idx].value;\n\t}, debugLocation);\n}\n\nfunction keybindingLabel(keybinding: IObservable<ResolvedKeybinding | undefined>) {\n\treturn derived(_reader => n.div({\n\t\tstyle: {},\n\t\tref: elem => {\n\t\t\tconst keybindingLabel = _reader.store.add(new KeybindingLabel(elem, OS, {\n\t\t\t\tdisableTitle: true,\n\t\t\t\t...defaultKeybindingLabelStyles,\n\t\t\t\tkeybindingLabelShadow: undefined,\n\t\t\t\tkeybindingLabelForeground: asCssVariable(inlineEditIndicatorPrimaryForeground),\n\t\t\t\tkeybindingLabelBackground: 'transparent',\n\t\t\t\tkeybindingLabelBorder: asCssVariable(inlineEditIndicatorPrimaryForeground),\n\t\t\t\tkeybindingLabelBottomBorder: undefined,\n\t\t\t}));\n\t\t\t_reader.store.add(autorun(reader => {\n\t\t\t\tkeybindingLabel.set(keybinding.read(reader));\n\t\t\t}));\n\t\t}\n\t}));\n}\n"]}