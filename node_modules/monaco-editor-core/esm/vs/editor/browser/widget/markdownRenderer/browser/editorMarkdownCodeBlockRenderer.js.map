{"version":3,"sources":["file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src/vs/editor/browser/widget/markdownRenderer/browser/editorMarkdownCodeBlockRenderer.ts","vs/editor/browser/widget/markdownRenderer/browser/editorMarkdownCodeBlockRenderer.ts"],"names":[],"mappings":"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","file":"editorMarkdownCodeBlockRenderer.js","sourceRoot":"file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isHTMLElement } from '../../../../../base/browser/dom.js';\nimport { createTrustedTypesPolicy } from '../../../../../base/browser/trustedTypes.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IMarkdownCodeBlockRenderer, IMarkdownRendererExtraOptions } from '../../../../../platform/markdown/browser/markdownRenderer.js';\nimport { EditorOption, IEditorOptions } from '../../../../common/config/editorOptions.js';\nimport { BareFontInfo } from '../../../../common/config/fontInfo.js';\nimport { createBareFontInfoFromRawSettings } from '../../../../common/config/fontInfoFromSettings.js';\nimport { ILanguageService } from '../../../../common/languages/language.js';\nimport { PLAINTEXT_LANGUAGE_ID } from '../../../../common/languages/modesRegistry.js';\nimport { tokenizeToString } from '../../../../common/languages/textToHtmlTokenizer.js';\nimport { applyFontInfo } from '../../../config/domFontInfo.js';\nimport { ICodeEditor, isCodeEditor } from '../../../editorBrowser.js';\nimport './renderedMarkdown.css';\n\n/**\n * Renders markdown code blocks using the editor's tokenization and font settings.\n */\nexport class EditorMarkdownCodeBlockRenderer implements IMarkdownCodeBlockRenderer {\n\n\tprivate static _ttpTokenizer = createTrustedTypesPolicy('tokenizeToString', {\n\t\tcreateHTML(html: string) {\n\t\t\treturn html;\n\t\t}\n\t});\n\n\tconstructor(\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t) { }\n\n\tpublic async renderCodeBlock(languageAlias: string | undefined, value: string, options: IMarkdownRendererExtraOptions): Promise<HTMLElement> {\n\t\tconst editor = isCodeEditor(options.context) ? options.context : undefined;\n\n\t\t// In markdown, it is possible that we stumble upon language aliases (e.g.js instead of javascript).\n\t\t// it is possible no alias is given in which case we fall back to the current editor lang\n\t\tlet languageId: string | undefined | null;\n\t\tif (languageAlias) {\n\t\t\tlanguageId = this._languageService.getLanguageIdByLanguageName(languageAlias);\n\t\t} else if (editor) {\n\t\t\tlanguageId = editor.getModel()?.getLanguageId();\n\t\t}\n\t\tif (!languageId) {\n\t\t\tlanguageId = PLAINTEXT_LANGUAGE_ID;\n\t\t}\n\t\tconst html = await tokenizeToString(this._languageService, value, languageId);\n\n\t\tconst content = EditorMarkdownCodeBlockRenderer._ttpTokenizer ? EditorMarkdownCodeBlockRenderer._ttpTokenizer.createHTML(html) ?? html : html;\n\n\t\tconst root = document.createElement('span');\n\t\troot.innerHTML = content as string;\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tconst codeElement = root.querySelector('.monaco-tokenized-source');\n\t\tif (!isHTMLElement(codeElement)) {\n\t\t\treturn document.createElement('span');\n\t\t}\n\n\t\tapplyFontInfo(codeElement, this.getFontInfo(editor));\n\n\t\treturn root;\n\t}\n\n\tprivate getFontInfo(editor: ICodeEditor | undefined): BareFontInfo {\n\t\t// Use editor's font if we have one\n\t\tif (editor) {\n\t\t\treturn editor.getOption(EditorOption.fontInfo);\n\t\t} else {\n\t\t\t// Otherwise use the global font settings.\n\t\t\t// Pass in fake pixel ratio of 1 since we only need the font info to apply font family\n\t\t\treturn createBareFontInfoFromRawSettings({\n\t\t\t\tfontFamily: this._configurationService.getValue<IEditorOptions>('editor').fontFamily\n\t\t\t}, 1);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isHTMLElement } from '../../../../../base/browser/dom.js';\nimport { createTrustedTypesPolicy } from '../../../../../base/browser/trustedTypes.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IMarkdownCodeBlockRenderer, IMarkdownRendererExtraOptions } from '../../../../../platform/markdown/browser/markdownRenderer.js';\nimport { EditorOption, IEditorOptions } from '../../../../common/config/editorOptions.js';\nimport { BareFontInfo } from '../../../../common/config/fontInfo.js';\nimport { createBareFontInfoFromRawSettings } from '../../../../common/config/fontInfoFromSettings.js';\nimport { ILanguageService } from '../../../../common/languages/language.js';\nimport { PLAINTEXT_LANGUAGE_ID } from '../../../../common/languages/modesRegistry.js';\nimport { tokenizeToString } from '../../../../common/languages/textToHtmlTokenizer.js';\nimport { applyFontInfo } from '../../../config/domFontInfo.js';\nimport { ICodeEditor, isCodeEditor } from '../../../editorBrowser.js';\nimport './renderedMarkdown.css';\n\n/**\n * Renders markdown code blocks using the editor's tokenization and font settings.\n */\nexport class EditorMarkdownCodeBlockRenderer implements IMarkdownCodeBlockRenderer {\n\n\tprivate static _ttpTokenizer = createTrustedTypesPolicy('tokenizeToString', {\n\t\tcreateHTML(html: string) {\n\t\t\treturn html;\n\t\t}\n\t});\n\n\tconstructor(\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t) { }\n\n\tpublic async renderCodeBlock(languageAlias: string | undefined, value: string, options: IMarkdownRendererExtraOptions): Promise<HTMLElement> {\n\t\tconst editor = isCodeEditor(options.context) ? options.context : undefined;\n\n\t\t// In markdown, it is possible that we stumble upon language aliases (e.g.js instead of javascript).\n\t\t// it is possible no alias is given in which case we fall back to the current editor lang\n\t\tlet languageId: string | undefined | null;\n\t\tif (languageAlias) {\n\t\t\tlanguageId = this._languageService.getLanguageIdByLanguageName(languageAlias);\n\t\t} else if (editor) {\n\t\t\tlanguageId = editor.getModel()?.getLanguageId();\n\t\t}\n\t\tif (!languageId) {\n\t\t\tlanguageId = PLAINTEXT_LANGUAGE_ID;\n\t\t}\n\t\tconst html = await tokenizeToString(this._languageService, value, languageId);\n\n\t\tconst content = EditorMarkdownCodeBlockRenderer._ttpTokenizer ? EditorMarkdownCodeBlockRenderer._ttpTokenizer.createHTML(html) ?? html : html;\n\n\t\tconst root = document.createElement('span');\n\t\troot.innerHTML = content as string;\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tconst codeElement = root.querySelector('.monaco-tokenized-source');\n\t\tif (!isHTMLElement(codeElement)) {\n\t\t\treturn document.createElement('span');\n\t\t}\n\n\t\tapplyFontInfo(codeElement, this.getFontInfo(editor));\n\n\t\treturn root;\n\t}\n\n\tprivate getFontInfo(editor: ICodeEditor | undefined): BareFontInfo {\n\t\t// Use editor's font if we have one\n\t\tif (editor) {\n\t\t\treturn editor.getOption(EditorOption.fontInfo);\n\t\t} else {\n\t\t\t// Otherwise use the global font settings.\n\t\t\t// Pass in fake pixel ratio of 1 since we only need the font info to apply font family\n\t\t\treturn createBareFontInfoFromRawSettings({\n\t\t\t\tfontFamily: this._configurationService.getValue<IEditorOptions>('editor').fontFamily\n\t\t\t}, 1);\n\t\t}\n\t}\n}\n"]}