{"version":3,"sources":["file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src/vs/editor/browser/widget/diffEditor/components/diffEditorViewZones/copySelection.ts","vs/editor/browser/widget/diffEditor/components/diffEditorViewZones/copySelection.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAEhG,OAAO,EAAE,qBAAqB,EAAE,MAAM,uCAAuC,CAAC;AAC9E,OAAO,EAAE,eAAe,EAAE,MAAM,4CAA4C,CAAC;AAC7E,OAAO,EAAE,KAAK,EAAE,MAAM,qCAAqC,CAAC;AAuB5D,MAAM,UAAU,mBAAmB,CAAC,OAA4C;IAC/E,MAAM,EAAE,OAAO,EAAE,iBAAiB,EAAE,SAAS,EAAE,aAAa,EAAE,gBAAgB,EAAE,GAAG,OAAO,CAAC;IAC3F,MAAM,kBAAkB,GAAG,IAAI,eAAe,EAAE,CAAC;IAEjD,kBAAkB,CAAC,GAAG,CAAC,qBAAqB,CAAC,OAAO,EAAE,MAAM,EAAE,CAAC,CAAC,EAAE,EAAE;QACnE,CAAC,CAAC,cAAc,EAAE,CAAC;QACnB,MAAM,SAAS,GAAG,OAAO,CAAC,aAAa,CAAC,YAAY,EAAE,CAAC;QACvD,IAAI,CAAC,SAAS,IAAI,SAAS,CAAC,UAAU,KAAK,CAAC,EAAE,CAAC;YAC9C,OAAO;QACR,CAAC;QAED,MAAM,QAAQ,GAAG,SAAS,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;QACzC,IAAI,CAAC,QAAQ,IAAI,QAAQ,CAAC,SAAS,EAAE,CAAC;YACrC,OAAO;QACR,CAAC;QAED,MAAM,YAAY,GAAG,QAAQ,CAAC,cAAc,CAAC,QAAQ,KAAK,IAAI,CAAC,SAAS;YACvE,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,aAAa;YACvC,CAAC,CAAC,QAAQ,CAAC,cAA6B,CAAC;QAC1C,MAAM,UAAU,GAAG,QAAQ,CAAC,YAAY,CAAC,QAAQ,KAAK,IAAI,CAAC,SAAS;YACnE,CAAC,CAAC,QAAQ,CAAC,YAAY,CAAC,aAAa;YACrC,CAAC,CAAC,QAAQ,CAAC,YAA2B,CAAC;QAExC,IAAI,CAAC,YAAY,IAAI,CAAC,UAAU,EAAE,CAAC;YAClC,OAAO;QACR,CAAC;QAED,MAAM,aAAa,GAAG,iBAAiB,CAAC,kBAAkB,CAAC,YAAY,EAAE,QAAQ,CAAC,WAAW,CAAC,CAAC;QAC/F,MAAM,WAAW,GAAG,iBAAiB,CAAC,kBAAkB,CAAC,UAAU,EAAE,QAAQ,CAAC,SAAS,CAAC,CAAC;QAEzF,IAAI,CAAC,aAAa,IAAI,CAAC,WAAW,EAAE,CAAC;YACpC,OAAO;QACR,CAAC;QAED,MAAM,aAAa,GAAG,aAAa,CAAC,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC,eAAe,GAAG,CAAC,CAAC,CAAC;QAClF,MAAM,WAAW,GAAG,WAAW,CAAC,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC,eAAe,GAAG,CAAC,CAAC,CAAC;QAE9E,MAAM,KAAK,GAAG,WAAW,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC,CAAC;YAClD,KAAK,CAAC,aAAa,CAAC,WAAW,EAAE,aAAa,CAAC,CAAC,CAAC;YACjD,KAAK,CAAC,aAAa,CAAC,aAAa,EAAE,WAAW,CAAC,CAAC;QAEjD,MAAM,YAAY,GAAG,aAAa,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;QAC1D,gBAAgB,CAAC,SAAS,CAAC,YAAY,CAAC,CAAC;IAC1C,CAAC,CAAC,CAAC,CAAC;IAEJ,OAAO,kBAAkB,CAAC;AAC3B,CAAC","file":"copySelection.js","sourceRoot":"file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { addDisposableListener } from '../../../../../../base/browser/dom.js';\nimport { DisposableStore } from '../../../../../../base/common/lifecycle.js';\nimport { Range } from '../../../../../common/core/range.js';\nimport { DetailedLineRangeMapping } from '../../../../../common/diff/rangeMapping.js';\nimport { ITextModel } from '../../../../../common/model.js';\nimport { IClipboardService } from '../../../../../../platform/clipboard/common/clipboardService.js';\nimport { RenderLinesResult } from './renderLines.js';\n\nexport interface IEnableViewZoneCopySelectionOptions {\n\t/** The view zone HTML element that contains the deleted codes. */\n\tdomNode: HTMLElement;\n\n\t/** The diff entry for the current view zone. */\n\tdiffEntry: DetailedLineRangeMapping;\n\n\t/** The original text model, to get the original text based on selection. */\n\toriginalModel: ITextModel;\n\n\t/** The render lines result that can translate DOM positions to model positions. */\n\trenderLinesResult: RenderLinesResult;\n\n\t/** The clipboard service to write the selected text to. */\n\tclipboardService: IClipboardService;\n}\n\nexport function enableCopySelection(options: IEnableViewZoneCopySelectionOptions): DisposableStore {\n\tconst { domNode, renderLinesResult, diffEntry, originalModel, clipboardService } = options;\n\tconst viewZoneDisposable = new DisposableStore();\n\n\tviewZoneDisposable.add(addDisposableListener(domNode, 'copy', (e) => {\n\t\te.preventDefault();\n\t\tconst selection = domNode.ownerDocument.getSelection();\n\t\tif (!selection || selection.rangeCount === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst domRange = selection.getRangeAt(0);\n\t\tif (!domRange || domRange.collapsed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst startElement = domRange.startContainer.nodeType === Node.TEXT_NODE\n\t\t\t? domRange.startContainer.parentElement\n\t\t\t: domRange.startContainer as HTMLElement;\n\t\tconst endElement = domRange.endContainer.nodeType === Node.TEXT_NODE\n\t\t\t? domRange.endContainer.parentElement\n\t\t\t: domRange.endContainer as HTMLElement;\n\n\t\tif (!startElement || !endElement) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst startPosition = renderLinesResult.getModelPositionAt(startElement, domRange.startOffset);\n\t\tconst endPosition = renderLinesResult.getModelPositionAt(endElement, domRange.endOffset);\n\n\t\tif (!startPosition || !endPosition) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst adjustedStart = startPosition.delta(diffEntry.original.startLineNumber - 1);\n\t\tconst adjustedEnd = endPosition.delta(diffEntry.original.startLineNumber - 1);\n\n\t\tconst range = adjustedEnd.isBefore(adjustedStart) ?\n\t\t\tRange.fromPositions(adjustedEnd, adjustedStart) :\n\t\t\tRange.fromPositions(adjustedStart, adjustedEnd);\n\n\t\tconst selectedText = originalModel.getValueInRange(range);\n\t\tclipboardService.writeText(selectedText);\n\t}));\n\n\treturn viewZoneDisposable;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { addDisposableListener } from '../../../../../../base/browser/dom.js';\nimport { DisposableStore } from '../../../../../../base/common/lifecycle.js';\nimport { Range } from '../../../../../common/core/range.js';\nimport { DetailedLineRangeMapping } from '../../../../../common/diff/rangeMapping.js';\nimport { ITextModel } from '../../../../../common/model.js';\nimport { IClipboardService } from '../../../../../../platform/clipboard/common/clipboardService.js';\nimport { RenderLinesResult } from './renderLines.js';\n\nexport interface IEnableViewZoneCopySelectionOptions {\n\t/** The view zone HTML element that contains the deleted codes. */\n\tdomNode: HTMLElement;\n\n\t/** The diff entry for the current view zone. */\n\tdiffEntry: DetailedLineRangeMapping;\n\n\t/** The original text model, to get the original text based on selection. */\n\toriginalModel: ITextModel;\n\n\t/** The render lines result that can translate DOM positions to model positions. */\n\trenderLinesResult: RenderLinesResult;\n\n\t/** The clipboard service to write the selected text to. */\n\tclipboardService: IClipboardService;\n}\n\nexport function enableCopySelection(options: IEnableViewZoneCopySelectionOptions): DisposableStore {\n\tconst { domNode, renderLinesResult, diffEntry, originalModel, clipboardService } = options;\n\tconst viewZoneDisposable = new DisposableStore();\n\n\tviewZoneDisposable.add(addDisposableListener(domNode, 'copy', (e) => {\n\t\te.preventDefault();\n\t\tconst selection = domNode.ownerDocument.getSelection();\n\t\tif (!selection || selection.rangeCount === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst domRange = selection.getRangeAt(0);\n\t\tif (!domRange || domRange.collapsed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst startElement = domRange.startContainer.nodeType === Node.TEXT_NODE\n\t\t\t? domRange.startContainer.parentElement\n\t\t\t: domRange.startContainer as HTMLElement;\n\t\tconst endElement = domRange.endContainer.nodeType === Node.TEXT_NODE\n\t\t\t? domRange.endContainer.parentElement\n\t\t\t: domRange.endContainer as HTMLElement;\n\n\t\tif (!startElement || !endElement) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst startPosition = renderLinesResult.getModelPositionAt(startElement, domRange.startOffset);\n\t\tconst endPosition = renderLinesResult.getModelPositionAt(endElement, domRange.endOffset);\n\n\t\tif (!startPosition || !endPosition) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst adjustedStart = startPosition.delta(diffEntry.original.startLineNumber - 1);\n\t\tconst adjustedEnd = endPosition.delta(diffEntry.original.startLineNumber - 1);\n\n\t\tconst range = adjustedEnd.isBefore(adjustedStart) ?\n\t\t\tRange.fromPositions(adjustedEnd, adjustedStart) :\n\t\t\tRange.fromPositions(adjustedStart, adjustedEnd);\n\n\t\tconst selectedText = originalModel.getValueInRange(range);\n\t\tclipboardService.writeText(selectedText);\n\t}));\n\n\treturn viewZoneDisposable;\n}\n"]}