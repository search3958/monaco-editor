{"version":3,"sources":["file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src/vs/base/common/validation.ts","vs/base/common/validation.ts"],"names":[],"mappings":"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","file":"validation.js","sourceRoot":"file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { mapFilter } from './arrays.js';\nimport { IJSONSchema } from './jsonSchema.js';\n\nexport interface IValidator<T> {\n\tvalidate(content: unknown): { content: T; error: undefined } | { content: undefined; error: ValidationError };\n\n\tgetJSONSchema(): IJSONSchema;\n}\n\nexport abstract class ValidatorBase<T> implements IValidator<T> {\n\tabstract validate(content: unknown): { content: T; error: undefined } | { content: undefined; error: ValidationError };\n\n\tabstract getJSONSchema(): IJSONSchema;\n\n\tvalidateOrThrow(content: unknown): T {\n\t\tconst result = this.validate(content);\n\t\tif (result.error) {\n\t\t\tthrow new Error(result.error.message);\n\t\t}\n\t\treturn result.content;\n\t}\n}\n\nexport type ValidatorType<T> = T extends IValidator<infer U> ? U : never;\n\nexport interface ValidationError {\n\tmessage: string;\n}\n\ntype TypeOfMap = {\n\tstring: string;\n\tnumber: number;\n\tboolean: boolean;\n\tobject: object;\n\tnull: null;\n};\n\nclass TypeofValidator<TKey extends keyof TypeOfMap> extends ValidatorBase<TypeOfMap[TKey]> {\n\tconstructor(private readonly type: TKey) {\n\t\tsuper();\n\t}\n\n\tvalidate(content: unknown): { content: TypeOfMap[TKey]; error: undefined } | { content: undefined; error: ValidationError } {\n\t\tif (typeof content !== this.type) {\n\t\t\treturn { content: undefined, error: { message: `Expected ${this.type}, but got ${typeof content}` } };\n\t\t}\n\n\t\treturn { content: content as TypeOfMap[TKey], error: undefined };\n\t}\n\n\tgetJSONSchema(): IJSONSchema {\n\t\treturn { type: this.type };\n\t}\n}\n\nconst vStringValidator = new TypeofValidator('string');\nexport function vString(): ValidatorBase<string> { return vStringValidator; }\n\nconst vNumberValidator = new TypeofValidator('number');\n\nconst vBooleanValidator = new TypeofValidator('boolean');\nexport function vBoolean(): ValidatorBase<boolean> { return vBooleanValidator; }\n\nconst vObjAnyValidator = new TypeofValidator('object');\n\n\nclass UncheckedValidator<T> extends ValidatorBase<T> {\n\tvalidate(content: unknown): { content: T; error: undefined } {\n\t\treturn { content: content as T, error: undefined };\n\t}\n\n\tgetJSONSchema(): IJSONSchema {\n\t\treturn {};\n\t}\n}\n\nexport function vUnchecked<T>(): ValidatorBase<T> {\n\treturn new UncheckedValidator<T>();\n}\n\nclass UndefinedValidator extends ValidatorBase<undefined> {\n\tvalidate(content: unknown): { content: undefined; error: undefined } | { content: undefined; error: ValidationError } {\n\t\tif (content !== undefined) {\n\t\t\treturn { content: undefined, error: { message: `Expected undefined, but got ${typeof content}` } };\n\t\t}\n\n\t\treturn { content: undefined, error: undefined };\n\t}\n\n\tgetJSONSchema(): IJSONSchema {\n\t\treturn {};\n\t}\n}\n\nexport function vUndefined(): ValidatorBase<undefined> {\n\treturn new UndefinedValidator();\n}\n\nexport class Optional<T extends IValidator<unknown>> {\n\tconstructor(public readonly validator: T) { }\n}\n\nexport function vOptionalProp<T>(validator: IValidator<T>): Optional<IValidator<T>> {\n\treturn new Optional(validator);\n}\n\ntype ExtractOptionalKeys<T> = {\n\t[K in keyof T]: T[K] extends Optional<IValidator<unknown>> ? K : never;\n}[keyof T];\n\ntype ExtractRequiredKeys<T> = {\n\t[K in keyof T]: T[K] extends Optional<IValidator<unknown>> ? never : K;\n}[keyof T];\n\nexport type vObjType<T extends Record<string, IValidator<unknown> | Optional<IValidator<unknown>>>> = {\n\t[K in ExtractRequiredKeys<T>]: T[K] extends IValidator<infer U> ? U : never;\n} & {\n\t[K in ExtractOptionalKeys<T>]?: T[K] extends Optional<IValidator<infer U>> ? U : never;\n};\n\nclass ObjValidator<T extends Record<string, IValidator<unknown> | Optional<IValidator<unknown>>>> extends ValidatorBase<vObjType<T>> {\n\tconstructor(private readonly properties: T) {\n\t\tsuper();\n\t}\n\n\tvalidate(content: unknown): { content: vObjType<T>; error: undefined } | { content: undefined; error: ValidationError } {\n\t\tif (typeof content !== 'object' || content === null) {\n\t\t\treturn { content: undefined, error: { message: 'Expected object' } };\n\t\t}\n\n\t\t// eslint-disable-next-line local/code-no-dangerous-type-assertions\n\t\tconst result: vObjType<T> = {} as vObjType<T>;\n\n\t\tfor (const key in this.properties) {\n\t\t\tconst prop = this.properties[key];\n\t\t\t// eslint-disable-next-line local/code-no-any-casts, @typescript-eslint/no-explicit-any\n\t\t\tconst fieldValue = (content as any)[key];\n\n\t\t\tconst isOptional = prop instanceof Optional;\n\t\t\tconst validator: IValidator<unknown> = isOptional ? prop.validator : prop;\n\n\t\t\tif (isOptional && fieldValue === undefined) {\n\t\t\t\t// Optional field not provided, skip validation\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst { content: value, error } = validator.validate(fieldValue);\n\t\t\tif (error) {\n\t\t\t\treturn { content: undefined, error: { message: `Error in property '${key}': ${error.message}` } };\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line local/code-no-any-casts, @typescript-eslint/no-explicit-any\n\t\t\t(result as any)[key] = value;\n\t\t}\n\n\t\treturn { content: result, error: undefined };\n\t}\n\n\tgetJSONSchema(): IJSONSchema {\n\t\tconst requiredFields: string[] = [];\n\t\tconst schemaProperties: Record<string, IJSONSchema> = {};\n\n\t\tfor (const [key, prop] of Object.entries(this.properties)) {\n\t\t\tconst isOptional = prop instanceof Optional;\n\t\t\tconst validator: IValidator<unknown> = isOptional ? prop.validator : prop;\n\t\t\tschemaProperties[key] = validator.getJSONSchema();\n\t\t\tif (!isOptional) {\n\t\t\t\trequiredFields.push(key);\n\t\t\t}\n\t\t}\n\n\t\tconst schema: IJSONSchema = {\n\t\t\ttype: 'object',\n\t\t\tproperties: schemaProperties,\n\t\t\t...(requiredFields.length > 0 ? { required: requiredFields } : {})\n\t\t};\n\n\t\treturn schema;\n\t}\n}\n\nexport function vObj<T extends Record<string, IValidator<unknown> | Optional<IValidator<unknown>>>>(properties: T): ValidatorBase<vObjType<T>> {\n\treturn new ObjValidator(properties);\n}\n\nclass UnionValidator<T extends IValidator<unknown>[]> extends ValidatorBase<ValidatorType<T[number]>> {\n\tconstructor(private readonly validators: T) {\n\t\tsuper();\n\t}\n\n\tvalidate(content: unknown): { content: ValidatorType<T[number]>; error: undefined } | { content: undefined; error: ValidationError } {\n\t\tlet lastError: ValidationError | undefined;\n\t\tfor (const validator of this.validators) {\n\t\t\tconst { content: value, error } = validator.validate(content);\n\t\t\tif (!error) {\n\t\t\t\t// eslint-disable-next-line local/code-no-any-casts, @typescript-eslint/no-explicit-any\n\t\t\t\treturn { content: value as any, error: undefined };\n\t\t\t}\n\n\t\t\tlastError = error;\n\t\t}\n\n\t\treturn { content: undefined, error: lastError! };\n\t}\n\n\tgetJSONSchema(): IJSONSchema {\n\t\treturn {\n\t\t\toneOf: mapFilter(this.validators, validator => {\n\t\t\t\tif (validator instanceof UndefinedValidator) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn validator.getJSONSchema();\n\t\t\t}),\n\t\t};\n\t}\n}\n\nexport function vUnion<T extends IValidator<unknown>[]>(...validators: T): ValidatorBase<ValidatorType<T[number]>> {\n\treturn new UnionValidator(validators);\n}\n\nclass UseRefSchemaValidator<T> extends ValidatorBase<T> {\n\tconstructor(\n\t\tprivate readonly _ref: string,\n\t\tprivate readonly _validator: IValidator<T>\n\t) {\n\t\tsuper();\n\t}\n\n\tvalidate(content: unknown): { content: T; error: undefined } | { content: undefined; error: ValidationError } {\n\t\treturn this._validator.validate(content);\n\t}\n\n\tgetJSONSchema(): IJSONSchema {\n\t\treturn { $ref: this._ref };\n\t}\n}\n\nexport function vWithJsonSchemaRef<T>(ref: string, validator: IValidator<T>): ValidatorBase<T> {\n\treturn new UseRefSchemaValidator(ref, validator);\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { mapFilter } from './arrays.js';\nimport { IJSONSchema } from './jsonSchema.js';\n\nexport interface IValidator<T> {\n\tvalidate(content: unknown): { content: T; error: undefined } | { content: undefined; error: ValidationError };\n\n\tgetJSONSchema(): IJSONSchema;\n}\n\nexport abstract class ValidatorBase<T> implements IValidator<T> {\n\tabstract validate(content: unknown): { content: T; error: undefined } | { content: undefined; error: ValidationError };\n\n\tabstract getJSONSchema(): IJSONSchema;\n\n\tvalidateOrThrow(content: unknown): T {\n\t\tconst result = this.validate(content);\n\t\tif (result.error) {\n\t\t\tthrow new Error(result.error.message);\n\t\t}\n\t\treturn result.content;\n\t}\n}\n\nexport type ValidatorType<T> = T extends IValidator<infer U> ? U : never;\n\nexport interface ValidationError {\n\tmessage: string;\n}\n\ntype TypeOfMap = {\n\tstring: string;\n\tnumber: number;\n\tboolean: boolean;\n\tobject: object;\n\tnull: null;\n};\n\nclass TypeofValidator<TKey extends keyof TypeOfMap> extends ValidatorBase<TypeOfMap[TKey]> {\n\tconstructor(private readonly type: TKey) {\n\t\tsuper();\n\t}\n\n\tvalidate(content: unknown): { content: TypeOfMap[TKey]; error: undefined } | { content: undefined; error: ValidationError } {\n\t\tif (typeof content !== this.type) {\n\t\t\treturn { content: undefined, error: { message: `Expected ${this.type}, but got ${typeof content}` } };\n\t\t}\n\n\t\treturn { content: content as TypeOfMap[TKey], error: undefined };\n\t}\n\n\tgetJSONSchema(): IJSONSchema {\n\t\treturn { type: this.type };\n\t}\n}\n\nconst vStringValidator = new TypeofValidator('string');\nexport function vString(): ValidatorBase<string> { return vStringValidator; }\n\nconst vNumberValidator = new TypeofValidator('number');\n\nconst vBooleanValidator = new TypeofValidator('boolean');\nexport function vBoolean(): ValidatorBase<boolean> { return vBooleanValidator; }\n\nconst vObjAnyValidator = new TypeofValidator('object');\n\n\nclass UncheckedValidator<T> extends ValidatorBase<T> {\n\tvalidate(content: unknown): { content: T; error: undefined } {\n\t\treturn { content: content as T, error: undefined };\n\t}\n\n\tgetJSONSchema(): IJSONSchema {\n\t\treturn {};\n\t}\n}\n\nexport function vUnchecked<T>(): ValidatorBase<T> {\n\treturn new UncheckedValidator<T>();\n}\n\nclass UndefinedValidator extends ValidatorBase<undefined> {\n\tvalidate(content: unknown): { content: undefined; error: undefined } | { content: undefined; error: ValidationError } {\n\t\tif (content !== undefined) {\n\t\t\treturn { content: undefined, error: { message: `Expected undefined, but got ${typeof content}` } };\n\t\t}\n\n\t\treturn { content: undefined, error: undefined };\n\t}\n\n\tgetJSONSchema(): IJSONSchema {\n\t\treturn {};\n\t}\n}\n\nexport function vUndefined(): ValidatorBase<undefined> {\n\treturn new UndefinedValidator();\n}\n\nexport class Optional<T extends IValidator<unknown>> {\n\tconstructor(public readonly validator: T) { }\n}\n\nexport function vOptionalProp<T>(validator: IValidator<T>): Optional<IValidator<T>> {\n\treturn new Optional(validator);\n}\n\ntype ExtractOptionalKeys<T> = {\n\t[K in keyof T]: T[K] extends Optional<IValidator<unknown>> ? K : never;\n}[keyof T];\n\ntype ExtractRequiredKeys<T> = {\n\t[K in keyof T]: T[K] extends Optional<IValidator<unknown>> ? never : K;\n}[keyof T];\n\nexport type vObjType<T extends Record<string, IValidator<unknown> | Optional<IValidator<unknown>>>> = {\n\t[K in ExtractRequiredKeys<T>]: T[K] extends IValidator<infer U> ? U : never;\n} & {\n\t[K in ExtractOptionalKeys<T>]?: T[K] extends Optional<IValidator<infer U>> ? U : never;\n};\n\nclass ObjValidator<T extends Record<string, IValidator<unknown> | Optional<IValidator<unknown>>>> extends ValidatorBase<vObjType<T>> {\n\tconstructor(private readonly properties: T) {\n\t\tsuper();\n\t}\n\n\tvalidate(content: unknown): { content: vObjType<T>; error: undefined } | { content: undefined; error: ValidationError } {\n\t\tif (typeof content !== 'object' || content === null) {\n\t\t\treturn { content: undefined, error: { message: 'Expected object' } };\n\t\t}\n\n\t\t// eslint-disable-next-line local/code-no-dangerous-type-assertions\n\t\tconst result: vObjType<T> = {} as vObjType<T>;\n\n\t\tfor (const key in this.properties) {\n\t\t\tconst prop = this.properties[key];\n\t\t\t// eslint-disable-next-line local/code-no-any-casts, @typescript-eslint/no-explicit-any\n\t\t\tconst fieldValue = (content as any)[key];\n\n\t\t\tconst isOptional = prop instanceof Optional;\n\t\t\tconst validator: IValidator<unknown> = isOptional ? prop.validator : prop;\n\n\t\t\tif (isOptional && fieldValue === undefined) {\n\t\t\t\t// Optional field not provided, skip validation\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst { content: value, error } = validator.validate(fieldValue);\n\t\t\tif (error) {\n\t\t\t\treturn { content: undefined, error: { message: `Error in property '${key}': ${error.message}` } };\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line local/code-no-any-casts, @typescript-eslint/no-explicit-any\n\t\t\t(result as any)[key] = value;\n\t\t}\n\n\t\treturn { content: result, error: undefined };\n\t}\n\n\tgetJSONSchema(): IJSONSchema {\n\t\tconst requiredFields: string[] = [];\n\t\tconst schemaProperties: Record<string, IJSONSchema> = {};\n\n\t\tfor (const [key, prop] of Object.entries(this.properties)) {\n\t\t\tconst isOptional = prop instanceof Optional;\n\t\t\tconst validator: IValidator<unknown> = isOptional ? prop.validator : prop;\n\t\t\tschemaProperties[key] = validator.getJSONSchema();\n\t\t\tif (!isOptional) {\n\t\t\t\trequiredFields.push(key);\n\t\t\t}\n\t\t}\n\n\t\tconst schema: IJSONSchema = {\n\t\t\ttype: 'object',\n\t\t\tproperties: schemaProperties,\n\t\t\t...(requiredFields.length > 0 ? { required: requiredFields } : {})\n\t\t};\n\n\t\treturn schema;\n\t}\n}\n\nexport function vObj<T extends Record<string, IValidator<unknown> | Optional<IValidator<unknown>>>>(properties: T): ValidatorBase<vObjType<T>> {\n\treturn new ObjValidator(properties);\n}\n\nclass UnionValidator<T extends IValidator<unknown>[]> extends ValidatorBase<ValidatorType<T[number]>> {\n\tconstructor(private readonly validators: T) {\n\t\tsuper();\n\t}\n\n\tvalidate(content: unknown): { content: ValidatorType<T[number]>; error: undefined } | { content: undefined; error: ValidationError } {\n\t\tlet lastError: ValidationError | undefined;\n\t\tfor (const validator of this.validators) {\n\t\t\tconst { content: value, error } = validator.validate(content);\n\t\t\tif (!error) {\n\t\t\t\t// eslint-disable-next-line local/code-no-any-casts, @typescript-eslint/no-explicit-any\n\t\t\t\treturn { content: value as any, error: undefined };\n\t\t\t}\n\n\t\t\tlastError = error;\n\t\t}\n\n\t\treturn { content: undefined, error: lastError! };\n\t}\n\n\tgetJSONSchema(): IJSONSchema {\n\t\treturn {\n\t\t\toneOf: mapFilter(this.validators, validator => {\n\t\t\t\tif (validator instanceof UndefinedValidator) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn validator.getJSONSchema();\n\t\t\t}),\n\t\t};\n\t}\n}\n\nexport function vUnion<T extends IValidator<unknown>[]>(...validators: T): ValidatorBase<ValidatorType<T[number]>> {\n\treturn new UnionValidator(validators);\n}\n\nclass UseRefSchemaValidator<T> extends ValidatorBase<T> {\n\tconstructor(\n\t\tprivate readonly _ref: string,\n\t\tprivate readonly _validator: IValidator<T>\n\t) {\n\t\tsuper();\n\t}\n\n\tvalidate(content: unknown): { content: T; error: undefined } | { content: undefined; error: ValidationError } {\n\t\treturn this._validator.validate(content);\n\t}\n\n\tgetJSONSchema(): IJSONSchema {\n\t\treturn { $ref: this._ref };\n\t}\n}\n\nexport function vWithJsonSchemaRef<T>(ref: string, validator: IValidator<T>): ValidatorBase<T> {\n\treturn new UseRefSchemaValidator(ref, validator);\n}\n"]}