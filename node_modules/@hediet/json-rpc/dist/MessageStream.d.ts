import { IValueWithChangeEvent, ValueWithChangeEvent } from "./base";
import { Message } from "./JsonRpcTypes";
import { RpcLogger } from "./Logger";
/**
 * Represents a bidirectional stream of messages.
 * No messages are lost when delaying reading with `setReadCallback`.
 */
export interface IMessageStream {
    isClosed: IValueWithChangeEvent<boolean>;
    write(message: Message): Promise<void>;
    /**
     * Sets a callback for incoming messages.
     * Processes all yet unhandled and future incoming messages.
     */
    setReadCallback(callback: ((readMessage: Message) => void) | undefined): void;
    /**
     * Returns human readable information of this message stream.
     */
    toString(): string;
}
/**
 * Base class for implementing a MessageStream.
 * Provides an unreadMessage queue.
 */
export declare abstract class BaseMessageStream implements IMessageStream {
    private static id;
    private readonly _unreadMessages;
    private _onMessageCallback;
    protected readonly id: number;
    private readonly _isClosed;
    readonly isClosed: ValueWithChangeEvent<boolean>;
    /**
     * Sets a callback for incoming messages.
     */
    setReadCallback(callback: ((readMessage: Message) => void) | undefined): void;
    /**
     * Writes a message to the stream.
     */
    abstract write(message: Message): Promise<void>;
    /**
     * Returns human readable information of this message stream.
     */
    abstract toString(): string;
    /**
     * Call this in derived classes to signal a new message.
     */
    protected _onMessage(message: Message): void;
    /**
     * Call this in derived classes to signal that the connection closed.
     */
    protected _onConnectionClosed(): void;
    log(logger?: IMessageLogger): IMessageStream;
}
/**
 * Used by `StreamLogger` to log messages.
 */
export interface IMessageLogger {
    log(stream: IMessageStream, type: "incoming" | "outgoing", message: Message): void;
}
/**
 * Intercepts a stream for logging.
 */
export declare class StreamLogger implements IMessageStream {
    private readonly baseStream;
    private readonly logger;
    constructor(baseStream: IMessageStream, logger: IMessageLogger);
    get isClosed(): IValueWithChangeEvent<boolean>;
    setReadCallback(callback: ((readMessage: Message) => void) | undefined): void;
    write(message: Message): Promise<void>;
    toString(): string;
}
/**
 * Logs messages to a `RpcLogger`.
 */
export declare class RpcStreamLogger extends StreamLogger {
    constructor(baseStream: IMessageStream, rpcLogger: RpcLogger);
}
/**
 * Logs messages to `console`.
 */
export declare class ConsoleStreamLogger extends StreamLogger {
    constructor(baseStream: IMessageStream);
}
export declare class ConsoleMessageLogger implements IMessageLogger {
    log(stream: IMessageStream, type: "incoming" | "outgoing", message: Message): void;
}
//# sourceMappingURL=MessageStream.d.ts.map