import { IValueWithChangeEvent } from "./common";
import { RequestId, ErrorObject, JSONValue, JSONArray, JSONObject } from "./JsonRpcTypes";
import { ConnectionState } from "./MessageTransport";
/**
 * Once a channel is constructed, it processes all incoming messages.
 */
export declare class Channel<TContext = void, TSenderContext = void> {
    readonly connect: (listener: IRequestHandler<TContext> | undefined) => IRequestSender<TSenderContext>;
    constructor(connect: (listener: IRequestHandler<TContext> | undefined) => IRequestSender<TSenderContext>);
    mapContext<TNewContext>(map: (context: TContext) => TNewContext): Channel<TNewContext, TSenderContext>;
}
/**
 * A message sender has methods to send requests and notifications.
 * A request expects a response, a notification does not.
 */
export interface IRequestSender<TContext = void> {
    /**
     * Sends a request.
     * @param request - The request to send.
     * @param messageIdCallback - An optional callback that is called before sending the request.
     *  		The passed request id can be used to track the request.
     * @return A promise of the response. Fails if the request could not be delivered or if a response could not be received.
     */
    sendRequest(request: RequestObject, context: TContext, messageIdCallback?: (id: RequestId) => void): Promise<ResponseObject>;
    /**
     * Sends a notification.
     * @return A promise that is fulfilled as soon as the notification has been sent successfully.
     *  	Fails if the notification could not be sent.
     */
    sendNotification(notification: RequestObject, context: TContext): Promise<void>;
    /**
     * Returns human readable information of this channel.
     */
    toString(): string;
    get state(): IValueWithChangeEvent<ConnectionState>;
}
/**
 * A request handler can handle requests and notifications.
 * Implementations must respond to all requests.
 */
export interface IRequestHandler<TContext = void> {
    /**
     * Handles an incoming request.
     */
    handleRequest(request: RequestObject, requestId: RequestId, context: TContext): Promise<ResponseObject>;
    handleNotification(request: RequestObject, context: TContext): Promise<void>;
}
/**
 * Represents a request.
 * The `method` property should be used for deciding what to do with it.
 */
export interface RequestObject {
    method: string;
    params: JSONArray | JSONObject | null;
}
/**
 * The result of a request.
 */
export type ResponseObject = {
    result: JSONValue;
} | {
    error: ErrorObject;
};
/**
 * Implements a channel that directly forwards the requests to the given request handler.
 */
export declare class LoopbackChannel<TContext> implements IRequestSender<TContext> {
    private readonly requestHandler;
    private id;
    constructor(requestHandler: IRequestHandler<TContext>);
    sendRequest(request: RequestObject, context: TContext, messageIdCallback?: (id: RequestId) => void): Promise<ResponseObject>;
    sendNotification(notification: RequestObject, context: TContext): Promise<void>;
    toString(): string;
    readonly state: IValueWithChangeEvent<ConnectionState>;
}
export declare function mapMessageSenderContext<TContext, TNewContext>(messageSender: IRequestSender<TContext>, map: (context: TNewContext) => TContext): IRequestSender<TNewContext>;
export declare function mapRequestHandlerContext<TContext, TNewContext>(messageHandler: IRequestHandler<TContext>, map: (context: TNewContext) => TContext): IRequestHandler<TNewContext>;
//# sourceMappingURL=Channel.d.ts.map